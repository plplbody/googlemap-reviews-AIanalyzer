# API利用料金・コスト試算

本アプリケーションで使用している主要なAPIサービスの料金体系と、想定されるランニングコストについてまとめます。
※料金は2025年12月時点の目安であり、Google Cloudの価格改定や為替レートにより変動する可能性があります。

## 1. 一覧画面でのAIスコア表示機能（確定版）

ユーザーとの協議により決定した「一覧検索時に詳細情報を一括取得し、全件AI分析を行う」アーキテクチャのコスト試算です。
**Google Places API (New) のリクエスト単位課金**を活用し、コストを最小限に抑えます。

### アーキテクチャ

1.  **一括詳細取得**: `Text Search (Enterprise)` を使用し、1回のリクエストで20件分の口コミ・詳細情報を取得します。
2.  **非同期AI分析**: 取得したデータをDBに保存し、バックグラウンドで全件に対してGemini分析を実行します。
3.  **リアルタイム表示**: ユーザー画面には分析が完了したものから順次スコアが表示されます。

### 1検索あたりのコスト試算 (20件表示時)

**前提**: ユーザーが検索ボタンを1回押し、20件の結果が表示される場合。

| 項目 | 課金単位 | 単価 | 数量 | コスト |
| :--- | :--- | :--- | :--- | :--- |
| **Google Places API** | Text Search (Enterprise) リクエスト | $35.00 / 1000回 | 1回 | **$0.035** |
| **Vertex AI (Gemini)** | 1.5 Flash (入力+出力) | ~$0.0005 / 件 | 20件 | **$0.010** |

**合計: 1回の検索あたり 約 $0.045 (約 6.8円)**

※ $1 = 150円換算
※ 全てが「初見の店舗」である場合の試算です。
※ 既にＤＢに分析データがある店舗が含まれる場合は、AIコストがさらに下がります（APIコストは検索リクエスト単位のため変わりません）。

### 結論

この方式は、以前検討した「都度詳細取得（B案：約100円）」と比較して **約1/15 のコスト** で実現可能です。
ユーザー体験（一覧で即スコア確認）とコストパフォーマンスを両立できる最適なプランです。

---

## 2. パーソナライズ機能の追加コスト (New)

ユーザー傾向分析とレコメンド機能の実装に伴う追加コストの試算です。

### A. 特徴タグ抽出 (Feature Extraction)
AI分析時に、「静か」「インスタ映え」などのタグを抽出します。
*   **コスト増目安**: 出力トークンが約1.2倍に増加。
*   **金額**: 1店舗あたり **+$0.0001 (約0.015円)**
*   **影響**: ほぼ無視できるレベルの微増です。

### B. ユーザープロファイル分析 (Profile Analysis)
ユーザーのGood/Bad履歴が溜まったタイミング（例: 10件ごと）で、バックグラウンドでユーザーの傾向ベクトルをAIが再計算する場合。
*   **Gemini 1.5 Flash**: 入力(履歴10件分) + 出力(分析結果)
*   **単価**: 1回あたり **約 $0.002 (約0.3円)**
*   **頻度**: 頻繁ではないため、月額コストへの影響は軽微です。

### C. 有料会員機能としての提案
レコメンド機能自体にかかる計算コスト（DB読み込み等）は低いですが、付加価値が高いため、以下のようなモデルが考えられます。

| プラン | 機能 | コスト（開発側） |
| :--- | :--- | :--- |
| **Free (無料)** | 検索・AIスコア表示・マイリスト保存・履歴閲覧 | 低 |
| **Premium (有料)** | **AI傾向分析レポート** (レーダーチャート・タグ)<br>**あなたへのおすすめ順** ソート<br>広告非表示 | 低〜中 |

技術的なコスト増は少ないため、**Premiumプランの利益率は非常に高く**なります。

---

## 3. その他のコスト情報

### Google Vertex AI (Gemini)
*   **Gemini 1.5 Flash**: 入力 ~$0.075 / 1Mトークン, 出力 ~$0.30 / 1Mトークン
*   **Gemini 1.5 Pro**: 入力 ~$3.50 / 1Mトークン, 出力 ~$10.50 / 1Mトークン

### Firebase (Firestore)
*   **読み取り/書き込み**: 通常利用の範囲内であれば少額（検索頻度によるが、数円〜数十円/月 程度からスタート）。
