{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 118, "column": 0}, "map": {"version":3,"sources":["file:///app/src/lib/firebase/client.ts"],"sourcesContent":["import { initializeApp, getApps } from 'firebase/app';\r\nimport { getFirestore, connectFirestoreEmulator } from 'firebase/firestore';\r\n\r\nconst firebaseConfig = {\r\n    apiKey: \"demo-key\",\r\n    authDomain: \"demo-project.firebaseapp.com\",\r\n    projectId: \"xenon-bivouac-479813-u1\",\r\n    storageBucket: \"demo-project.appspot.com\",\r\n    messagingSenderId: \"123456789\",\r\n    appId: \"1:123456789:web:abcdef\"\r\n};\r\n\r\n// Initialize Firebase\r\nconst app = getApps().length === 0 ? initializeApp(firebaseConfig) : getApps()[0];\r\nconst firestore = getFirestore(app);\r\n\r\n// Connect to Emulator in Dev\r\nif (process.env.NODE_ENV === 'development') {\r\n    // Check if already connected to avoid errors on hot reload?\r\n    // Firestore SDK handles this gracefully usually, but let's be safe\r\n    // Actually, connectFirestoreEmulator should be called before any operation\r\n    try {\r\n        connectFirestoreEmulator(firestore, 'localhost', 8080);\r\n        console.log('Connected to Firestore Emulator');\r\n    } catch (e) {\r\n        // Ignore if already connected\r\n    }\r\n}\r\n\r\nexport { firestore };\r\n"],"names":[],"mappings":";;;;AAAA;AAAA;AACA;AAAA;;;AAEA,MAAM,iBAAiB;IACnB,QAAQ;IACR,YAAY;IACZ,WAAW;IACX,eAAe;IACf,mBAAmB;IACnB,OAAO;AACX;AAEA,sBAAsB;AACtB,MAAM,MAAM,IAAA,2KAAO,IAAG,MAAM,KAAK,IAAI,IAAA,iLAAa,EAAC,kBAAkB,IAAA,2KAAO,GAAE,CAAC,EAAE;AACjF,MAAM,YAAY,IAAA,iLAAY,EAAC;AAE/B,6BAA6B;AAC7B,wCAA4C;IACxC,4DAA4D;IAC5D,mEAAmE;IACnE,2EAA2E;IAC3E,IAAI;QACA,IAAA,6LAAwB,EAAC,WAAW,aAAa;QACjD,QAAQ,GAAG,CAAC;IAChB,EAAE,OAAO,GAAG;IACR,8BAA8B;IAClC;AACJ"}},
    {"offset": {"line": 156, "column": 0}, "map": {"version":3,"sources":["file:///app/src/components/ui/SearchInput.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { useState } from 'react';\r\nimport { Search, Loader2, MapPin, Calendar } from 'lucide-react';\r\nimport { searchAndAnalyze } from '@/server/actions/place';\r\n\r\ninterface SearchInputProps {\r\n    onSearchStart: () => void;\r\n    onSearchComplete: (query: string) => void;\r\n}\r\n\r\nexport default function SearchInput({ onSearchStart, onSearchComplete }: SearchInputProps) {\r\n    const [keyword, setKeyword] = useState('');\r\n    const [area, setArea] = useState('');\r\n    const [loading, setLoading] = useState(false);\r\n\r\n    const handleSearch = async (e: React.FormEvent) => {\r\n        e.preventDefault();\r\n        if (!keyword.trim() && !area.trim()) return;\r\n\r\n        setLoading(true);\r\n        onSearchStart();\r\n        try {\r\n            // Combine keyword and area for the search query\r\n            const searchQuery = [keyword, area].filter(Boolean).join(' ');\r\n            await onSearchComplete(searchQuery);\r\n        } catch (error) {\r\n            console.error(error);\r\n        } finally {\r\n            setLoading(false);\r\n        }\r\n    };\r\n\r\n    return (\r\n        <div className=\"w-full max-w-4xl mx-auto relative z-10\">\r\n            <form onSubmit={handleSearch} className=\"relative flex items-center bg-white/80 backdrop-blur-md border border-white/20 rounded-full shadow-2xl hover:shadow-orange-500/20 transition-all duration-300 overflow-hidden p-2 h-20 w-full group\">\r\n\r\n                {/* キーワード入力欄 */}\r\n                <div className=\"flex-1 flex flex-col justify-center px-6 border-r border-slate-200/50 hover:bg-white/50 transition-colors h-full\">\r\n                    <label htmlFor=\"keyword\" className=\"text-xs font-bold text-slate-500 mb-0.5 uppercase tracking-wider\">Keyword</label>\r\n                    <input\r\n                        id=\"keyword\"\r\n                        type=\"text\"\r\n                        value={keyword}\r\n                        onChange={(e) => setKeyword(e.target.value)}\r\n                        placeholder=\"店名・ジャンル・キーワード\"\r\n                        className=\"w-full bg-transparent border-none focus:ring-0 p-0 text-slate-900 font-bold placeholder:text-slate-300 text-base truncate\"\r\n                    />\r\n                </div>\r\n\r\n                {/* エリア入力欄 */}\r\n                <div className=\"flex-1 flex flex-col justify-center px-6 hover:bg-white/50 transition-colors h-full hidden md:flex\">\r\n                    <label htmlFor=\"area\" className=\"text-xs font-bold text-slate-500 mb-0.5 uppercase tracking-wider\">Area</label>\r\n                    <input\r\n                        id=\"area\"\r\n                        type=\"text\"\r\n                        value={area}\r\n                        onChange={(e) => setArea(e.target.value)}\r\n                        placeholder=\"エリア（例：渋谷、銀座）\"\r\n                        className=\"w-full bg-transparent border-none focus:ring-0 p-0 text-slate-900 font-bold placeholder:text-slate-300 text-base truncate\"\r\n                    />\r\n                </div>\r\n\r\n                {/* 検索ボタン */}\r\n                <button\r\n                    type=\"submit\"\r\n                    disabled={loading}\r\n                    className=\"ml-2 bg-[#E65100] hover:bg-[#F57C00] text-white p-4 rounded-full transition-all duration-300 flex items-center justify-center shadow-lg hover:shadow-orange-500/50 hover:scale-105 active:scale-95 disabled:opacity-50 disabled:hover:scale-100 aspect-square h-14 w-14\"\r\n                >\r\n                    {loading ? <Loader2 className=\"w-6 h-6 animate-spin\" /> : <Search className=\"w-6 h-6 font-bold\" />}\r\n                </button>\r\n            </form>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AACA;AAAA;AAHA;;;;AAWe,SAAS,YAAY,EAAE,aAAa,EAAE,gBAAgB,EAAoB;IACrF,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IACvC,MAAM,CAAC,MAAM,QAAQ,GAAG,IAAA,iNAAQ,EAAC;IACjC,MAAM,CAAC,SAAS,WAAW,GAAG,IAAA,iNAAQ,EAAC;IAEvC,MAAM,eAAe,OAAO;QACxB,EAAE,cAAc;QAChB,IAAI,CAAC,QAAQ,IAAI,MAAM,CAAC,KAAK,IAAI,IAAI;QAErC,WAAW;QACX;QACA,IAAI;YACA,gDAAgD;YAChD,MAAM,cAAc;gBAAC;gBAAS;aAAK,CAAC,MAAM,CAAC,SAAS,IAAI,CAAC;YACzD,MAAM,iBAAiB;QAC3B,EAAE,OAAO,OAAO;YACZ,QAAQ,KAAK,CAAC;QAClB,SAAU;YACN,WAAW;QACf;IACJ;IAEA,qBACI,8OAAC;QAAI,WAAU;kBACX,cAAA,8OAAC;YAAK,UAAU;YAAc,WAAU;;8BAGpC,8OAAC;oBAAI,WAAU;;sCACX,8OAAC;4BAAM,SAAQ;4BAAU,WAAU;sCAAmE;;;;;;sCACtG,8OAAC;4BACG,IAAG;4BACH,MAAK;4BACL,OAAO;4BACP,UAAU,CAAC,IAAM,WAAW,EAAE,MAAM,CAAC,KAAK;4BAC1C,aAAY;4BACZ,WAAU;;;;;;;;;;;;8BAKlB,8OAAC;oBAAI,WAAU;;sCACX,8OAAC;4BAAM,SAAQ;4BAAO,WAAU;sCAAmE;;;;;;sCACnG,8OAAC;4BACG,IAAG;4BACH,MAAK;4BACL,OAAO;4BACP,UAAU,CAAC,IAAM,QAAQ,EAAE,MAAM,CAAC,KAAK;4BACvC,aAAY;4BACZ,WAAU;;;;;;;;;;;;8BAKlB,8OAAC;oBACG,MAAK;oBACL,UAAU;oBACV,WAAU;8BAET,wBAAU,8OAAC,4NAAO;wBAAC,WAAU;;;;;6CAA4B,8OAAC,gNAAM;wBAAC,WAAU;;;;;;;;;;;;;;;;;;;;;;AAKhG"}},
    {"offset": {"line": 294, "column": 0}, "map": {"version":3,"sources":["file:///app/src/server/actions/place.ts"],"sourcesContent":["'use server';\r\n\r\nimport { GoogleAuth } from 'google-auth-library';\r\nimport { getFirestore } from '@/lib/firebase/admin';\r\nimport { enqueueAnalysis } from '@/lib/queue/client';\r\nimport { Place } from '@/types/schema';\r\n\r\nexport async function searchAndAnalyze(query: string): Promise<string> {\r\n    console.log(`Analyzing place: ${query}`);\r\n    const placeId = query; // In the new flow, query is the placeId\r\n\r\n    const docRef = getFirestore().collection('places').doc(placeId);\r\n    const doc = await docRef.get();\r\n\r\n    if (doc.exists) {\r\n        const data = doc.data() as Place;\r\n        console.log(`Place ${placeId} found. Status: ${data.status}`);\r\n\r\n        // Check for expiration (30 days)\r\n        const now = new Date();\r\n        const updatedAt = data.updatedAt ? (data.updatedAt as any).toDate() : new Date(0); // Handle Firestore Timestamp\r\n        const diffTime = Math.abs(now.getTime() - updatedAt.getTime());\r\n        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n\r\n        if (diffDays > 30) {\r\n            console.log(`Place ${placeId} data is expired (${diffDays} days old). Re-fetching...`);\r\n            // Fall through to fetch logic\r\n        } else if (data.status === 'error') {\r\n            await enqueueAnalysis(placeId);\r\n            return placeId;\r\n        } else {\r\n            return placeId;\r\n        }\r\n    }\r\n\r\n    // If we are here, it means either doc doesn't exist OR it's expired.\r\n    // We need to fetch from Google Places API.\r\n    console.log(`Fetching fresh data for place ${placeId}...`);\r\n\r\n    try {\r\n        const auth = new GoogleAuth({\r\n            scopes: 'https://www.googleapis.com/auth/cloud-platform'\r\n        });\r\n        const client = await auth.getClient();\r\n        const token = await client.getAccessToken();\r\n\r\n        const baseUrl = `https://places.googleapis.com/v1/places/${placeId}?languageCode=ja`;\r\n        const headers = {\r\n            'Content-Type': 'application/json',\r\n            'Authorization': `Bearer ${token.token}`,\r\n            'X-Goog-FieldMask': 'id,displayName,formattedAddress,rating,userRatingCount,reviews,priceLevel,priceRange,paymentOptions,delivery,takeout,dineIn,reservable,servesBeer,servesWine,servesVegetarianFood,servesCoffee,servesBreakfast,servesLunch,servesDinner,goodForChildren,goodForGroups,restroom,accessibilityOptions'\r\n        };\r\n\r\n        const response = await fetch(baseUrl, { method: 'GET', headers });\r\n\r\n        if (!response.ok) {\r\n            const errorText = await response.text();\r\n            console.error('Google Places API Details Error:', errorText);\r\n            throw new Error(`Google Places API Error: ${response.statusText}`);\r\n        }\r\n\r\n        const data = await response.json();\r\n        console.log('API Response Data:', JSON.stringify(data, null, 2));\r\n\r\n        // Extract reviews\r\n        const reviews = data.reviews?.map((r: any) => r.text?.text).filter(Boolean) || [];\r\n\r\n        console.log(`Fetched reviews: ${reviews.length}`);\r\n\r\n        const newPlace: Place = {\r\n            id: data.id,\r\n            name: data.displayName?.text || 'Unknown',\r\n            address: data.formattedAddress,\r\n            originalRating: data.rating || 0,\r\n            userRatingsTotal: data.userRatingCount || 0,\r\n            ...(data.priceLevel ? { priceLevel: data.priceLevel } : {}),\r\n            ...(data.priceRange ? { priceRange: data.priceRange } : {}),\r\n            reviews: reviews,\r\n            detailedInfo: {\r\n                paymentOptions: data.paymentOptions,\r\n                serviceOptions: {\r\n                    delivery: data.delivery,\r\n                    takeout: data.takeout,\r\n                    dineIn: data.dineIn,\r\n                    reservable: data.reservable\r\n                },\r\n                offerings: {\r\n                    servesBeer: data.servesBeer,\r\n                    servesWine: data.servesWine,\r\n                    servesVegetarianFood: data.servesVegetarianFood,\r\n                    servesCoffee: data.servesCoffee\r\n                },\r\n                diningOptions: {\r\n                    servesBreakfast: data.servesBreakfast,\r\n                    servesLunch: data.servesLunch,\r\n                    servesDinner: data.servesDinner\r\n                },\r\n                amenities: {\r\n                    restroom: data.restroom,\r\n                    goodForChildren: data.goodForChildren,\r\n                    goodForGroups: data.goodForGroups\r\n                },\r\n            },\r\n            status: 'pending',\r\n            createdAt: doc.exists ? (doc.data() as Place).createdAt : new Date(), // Keep original createdAt if exists\r\n            updatedAt: new Date(),\r\n        };\r\n\r\n        await docRef.set(newPlace);\r\n        await enqueueAnalysis(placeId);\r\n\r\n    } catch (error) {\r\n        console.error('Failed to fetch place details:', error);\r\n        throw error;\r\n    }\r\n\r\n    return placeId;\r\n}\r\n\r\nexport interface PlaceSearchResult {\r\n    id: string;\r\n    name: string;\r\n    rating: number;\r\n    userRatingsTotal: number;\r\n    vicinity?: string;\r\n}\r\n\r\nasync function searchPlacesIdOnly(query: string): Promise<string[]> {\r\n    console.log(`Searching places (ID only) for: ${query}`);\r\n    try {\r\n        const auth = new GoogleAuth({\r\n            scopes: 'https://www.googleapis.com/auth/cloud-platform'\r\n        });\r\n        const client = await auth.getClient();\r\n        const token = await client.getAccessToken();\r\n\r\n        const response = await fetch('https://places.googleapis.com/v1/places:searchText', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${token.token}`,\r\n                'X-Goog-FieldMask': 'places.id'\r\n            },\r\n            body: JSON.stringify({\r\n                textQuery: query,\r\n                languageCode: 'ja',\r\n                maxResultCount: 20\r\n            })\r\n        });\r\n\r\n        if (!response.ok) {\r\n            throw new Error(`Google Places API Error: ${response.statusText}`);\r\n        }\r\n\r\n        const data = await response.json();\r\n        return data.places?.map((p: any) => p.id) || [];\r\n    } catch (error) {\r\n        console.error('Failed to search places (ID only):', error);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport interface PlaceSearchResponse {\r\n    places: PlaceSearchResult[];\r\n    nextPageToken?: string;\r\n}\r\n\r\nexport async function searchPlaces(query: string, pageToken?: string): Promise<PlaceSearchResponse> {\r\n    console.log(`Searching places list for: ${query}, pageToken: ${pageToken ? 'Yes' : 'No'}`);\r\n\r\n    try {\r\n        // 1. ID Search (Free) - Skip if paging\r\n        // Pagination usually implies we skip the efficient ID-only check because we can't easily map pages to IDs without fetching.\r\n        // Also, cache logic is complex with pagination.\r\n        // For simplicity: If pageToken is present, go straight to API.\r\n        // If no pageToken, we can TRY cache, but we need to know if we have *all* results?\r\n        // Actually, the previous cache logic was \"If we have ALL 20 IDs in cache\".\r\n        // Now valid for first page.\r\n\r\n        let placeIds: string[] = [];\r\n\r\n        // Only do ID search for first page to check cache\r\n        if (!pageToken) {\r\n            placeIds = await searchPlacesIdOnly(query);\r\n            if (placeIds.length === 0 && !pageToken) return { places: [] };\r\n\r\n            // 2. Check Cache (Only for first page)\r\n            const db = getFirestore();\r\n            const placesRef = db.collection('places');\r\n            const cachedPlaces: PlaceSearchResult[] = [];\r\n            let allCached = true;\r\n\r\n            for (const id of placeIds) {\r\n                const doc = await placesRef.doc(id).get();\r\n                if (doc.exists) {\r\n                    const data = doc.data() as Place;\r\n                    // Check expiration (30 days)\r\n                    const now = new Date();\r\n                    const updatedAt = data.updatedAt ? (data.updatedAt as any).toDate() : new Date(0);\r\n                    const diffTime = Math.abs(now.getTime() - updatedAt.getTime());\r\n                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n\r\n                    if (diffDays <= 30 && data.status !== 'error') {\r\n                        cachedPlaces.push({\r\n                            id: data.id,\r\n                            name: data.name,\r\n                            rating: data.originalRating,\r\n                            userRatingsTotal: data.userRatingsTotal,\r\n                            vicinity: data.address\r\n                        });\r\n                    } else {\r\n                        allCached = false;\r\n                        break;\r\n                    }\r\n                } else {\r\n                    allCached = false;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            // 3. Conditional Return (Only if all cached and no page token needed logic?)\r\n            // If we have cached data for the top 20, we return them.\r\n            // Converting cache hits to a \"Next Page\" capable response is tricky because we don't have the nextPageToken from the original API call stored.\r\n            // If we return cached data, the user CANNOT load more because we don't have the token.\r\n            // ERROR: Using cache breaks pagination?\r\n            // \"Load More\" relies on Google's `nextPageToken`. Reviewing flow:\r\n            // Query -> Google API -> Returns items + Token.\r\n            // If we satisfy from Cache, we DON'T have the Token.\r\n            // So if we use Cache, \"Load More\" is impossible unless we re-fetch from API using the original query?\r\n            // Compromise: If we return cached results, we set `nextPageToken` to null.\r\n            // If the user wants \"More\", they might be stuck?\r\n            // Actually, if the cache has 20 items, and we show 20 items...\r\n            // User says \"Load More\". We don't have token.\r\n            // We'd have to trigger a NEW search (API) skipping the first 20? No, Google API doesn't support \"offset\".\r\n            // So, if we want to support \"Load More\", we MUST fetch from API to get the token, OR we accept that \"Cached results have no next page\".\r\n            // Since the user EXPLICITLY requested \"More\", we should prioritize API token availability if possible, OR just disable cache for now to ensure feature works?\r\n            // Or, we return cached results, but if user clicks \"More\" (which won't exist?), they can't.\r\n            // Let's Disable Cache for now to ensure Pagination works correctly as per user request.\r\n            // Or only disable cache if we expect more than 20 results? We don't know.\r\n            // Disabling cache for Search List is safer for this feature.\r\n\r\n            // NOTE: Caching currently disabled for direct search to ensure PAGINATION works (needs fresh nextPageToken).\r\n        }\r\n\r\n        console.log('Fetching fresh data from API...');\r\n\r\n        // 4. Fallback to Full Search (Pro)\r\n        const auth = new GoogleAuth({\r\n            scopes: 'https://www.googleapis.com/auth/cloud-platform'\r\n        });\r\n        const client = await auth.getClient();\r\n        const token = await client.getAccessToken();\r\n\r\n        const requestBody: any = {\r\n            textQuery: query,\r\n            languageCode: 'ja',\r\n            maxResultCount: 20\r\n        };\r\n\r\n        if (pageToken) {\r\n            requestBody.pageToken = pageToken;\r\n        }\r\n\r\n        const response = await fetch('https://places.googleapis.com/v1/places:searchText', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${token.token}`,\r\n                'X-Goog-FieldMask': 'places.id,places.displayName,places.formattedAddress,places.rating,places.userRatingCount,places.reviews,places.priceLevel,places.priceRange,places.paymentOptions,places.delivery,places.takeout,places.dineIn,places.reservable,places.servesBeer,places.servesWine,places.servesVegetarianFood,places.servesCoffee,places.servesBreakfast,places.servesLunch,places.servesDinner,places.goodForChildren,places.goodForGroups,places.restroom,places.accessibilityOptions,nextPageToken'\r\n            },\r\n            body: JSON.stringify(requestBody)\r\n        });\r\n\r\n        if (!response.ok) {\r\n            const errorText = await response.text();\r\n            console.error('Google Places API Error:', errorText);\r\n            throw new Error(`Google Places API Error: ${response.statusText}`);\r\n        }\r\n\r\n        const data = await response.json();\r\n\r\n        if (!data.places) {\r\n            return { places: [] };\r\n        }\r\n\r\n        const db = getFirestore(); // Ensure DB is initialized\r\n        const placesRef = db.collection('places');\r\n        const batch = db.batch();\r\n        const results: PlaceSearchResult[] = [];\r\n\r\n        for (const placeData of data.places) {\r\n            const reviews = placeData.reviews?.map((r: any) => r.text?.text).filter(Boolean) || [];\r\n\r\n            // Construct full Place object to cache\r\n            // Use Partial<Place> to avoid 'missing property' errors when we deliberately omit 'status' to preserve it\r\n            const newPlace: Partial<Place> = {\r\n                id: placeData.id,\r\n                name: placeData.displayName?.text || 'Unknown',\r\n                address: placeData.formattedAddress,\r\n                originalRating: placeData.rating || 0,\r\n                userRatingsTotal: placeData.userRatingCount || 0,\r\n                ...(placeData.priceLevel ? { priceLevel: placeData.priceLevel } : {}),\r\n                ...(placeData.priceRange ? { priceRange: placeData.priceRange } : {}),\r\n                reviews: reviews,\r\n                detailedInfo: {\r\n                    paymentOptions: placeData.paymentOptions,\r\n                    serviceOptions: {\r\n                        delivery: placeData.delivery,\r\n                        takeout: placeData.takeout,\r\n                        dineIn: placeData.dineIn,\r\n                        reservable: placeData.reservable\r\n                    },\r\n                    offerings: {\r\n                        servesBeer: placeData.servesBeer,\r\n                        servesWine: placeData.servesWine,\r\n                        servesVegetarianFood: placeData.servesVegetarianFood,\r\n                        servesCoffee: placeData.servesCoffee\r\n                    },\r\n                    diningOptions: {\r\n                        servesBreakfast: placeData.servesBreakfast,\r\n                        servesLunch: placeData.servesLunch,\r\n                        servesDinner: placeData.servesDinner\r\n                    },\r\n                    amenities: {\r\n                        restroom: placeData.restroom,\r\n                        goodForChildren: placeData.goodForChildren,\r\n                        goodForGroups: placeData.goodForGroups\r\n                    }\r\n                },\r\n                updatedAt: new Date(),\r\n            };\r\n\r\n            // Prepare for return\r\n            results.push({\r\n                id: placeData.id,\r\n                name: placeData.displayName?.text || 'Unknown',\r\n                rating: placeData.rating || 0,\r\n                userRatingsTotal: placeData.userRatingCount || 0,\r\n                vicinity: placeData.formattedAddress\r\n            });\r\n\r\n            const ref = placesRef.doc(placeData.id);\r\n            // Use merge: true to update existing docs without wiping other fields\r\n            batch.set(ref, newPlace, { merge: true });\r\n        }\r\n\r\n        await batch.commit();\r\n\r\n        // Fire-and-forget analysis for items needing it\r\n        (async () => {\r\n            const refs = results.map(r => placesRef.doc(r.id));\r\n            if (refs.length === 0) return;\r\n\r\n            try {\r\n                const snapshots = await db.getAll(...refs);\r\n\r\n                for (const snap of snapshots) {\r\n                    const d = snap.data() as Place;\r\n                    // Trigger if:\r\n                    // 1. Status is MISSING (new)\r\n                    // 2. OR Status is 'error'\r\n                    // 3. We do NOT re-trigger if 'pending', 'processing', 'completed'.\r\n                    if (!d.status || d.status === 'error') {\r\n                        console.log(`Triggering analysis for ${d.id}`);\r\n                        // Set status to pending to prevent double-queueing? \r\n                        // Ideally yes, but fire-and-forget.\r\n                        enqueueAnalysis(d.id).catch(e => console.error(`Failed to enqueue ${d.id}`, e));\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                console.error(\"Error checking status for analysis trigger\", e);\r\n            }\r\n        })();\r\n\r\n        return {\r\n            places: results,\r\n            nextPageToken: data.nextPageToken\r\n        };\r\n\r\n    } catch (error) {\r\n        console.error('Failed to search places:', error);\r\n        return { places: [] };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;IAOsB,mBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 306, "column": 0}, "map": {"version":3,"sources":["file:///app/src/server/actions/config.ts"],"sourcesContent":["'use server';\r\n\r\nexport async function getGoogleMapsApiKey(): Promise<string> {\r\n    const key = process.env.GOOGLE_MAPS_API_KEY;\r\n    console.log('getGoogleMapsApiKey called. Key exists:', !!key);\r\n    if (!key) {\r\n        console.warn('GOOGLE_MAPS_API_KEY is not set');\r\n        return '';\r\n    }\r\n    return key;\r\n}\r\n"],"names":[],"mappings":";;;;;;;IAEsB,sBAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 318, "column": 0}, "map": {"version":3,"sources":["file:///app/src/components/AnalysisResult.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { Place } from '@/types/schema';\r\nimport { searchAndAnalyze } from '@/server/actions/place';\r\nimport { getGoogleMapsApiKey } from '@/server/actions/config';\r\nimport { useState, useEffect } from 'react';\r\nimport { ResponsiveContainer, RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Radar } from 'recharts';\r\nimport { Loader2, Star, TrendingUp, DollarSign, Coffee, Smile, MapPin, Briefcase, Heart, User, Users, Award, RefreshCw, Map, Utensils, Wine, Accessibility, CreditCard, Check, X, Sparkles } from 'lucide-react';\r\n\r\ninterface AnalysisResultProps {\r\n    place: Place;\r\n    focusedAxes?: string[];\r\n    onToggleAxis?: (axis: string) => void;\r\n}\r\n\r\nexport default function AnalysisResult({ place, focusedAxes = [], onToggleAxis }: AnalysisResultProps) {\r\n    const [activeTab, setActiveTab] = useState<'evaluation' | 'map'>('evaluation');\r\n    const [apiKey, setApiKey] = useState('');\r\n    const [isRetrying, setIsRetrying] = useState(false);\r\n\r\n    useEffect(() => {\r\n        getGoogleMapsApiKey().then(key => {\r\n            console.log('API Key fetched:', !!key);\r\n            setApiKey(key);\r\n        });\r\n    }, []);\r\n\r\n    const handleRetry = async () => {\r\n        setIsRetrying(true);\r\n        try {\r\n            await searchAndAnalyze(place.id);\r\n        } catch (error) {\r\n            console.error(\"Retry failed:\", error);\r\n            setIsRetrying(false);\r\n        }\r\n    };\r\n\r\n    if (place.status === 'pending' || place.status === 'processing' || isRetrying) {\r\n        return (\r\n            <div className=\"flex flex-col items-center justify-center p-12 space-y-4 animate-pulse\">\r\n                <Loader2 className=\"w-12 h-12 text-rose-500 animate-spin\" />\r\n                <p className=\"text-xl text-slate-800 font-medium\">AIが分析中...</p>\r\n                <p className=\"text-sm text-slate-500\">数千件のレビューから真実を抽出しています</p>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    if (place.status === 'error') {\r\n        return (\r\n            <div className=\"p-8 bg-red-50 border border-red-100 rounded-3xl text-center shadow-sm flex flex-col items-center gap-4\">\r\n                <p className=\"text-red-600 font-medium\">分析に失敗しました。時間をおいて再度お試しください。</p>\r\n                <button\r\n                    onClick={handleRetry}\r\n                    disabled={isRetrying}\r\n                    className=\"flex items-center gap-2 px-6 py-2 bg-white border border-red-200 text-red-600 rounded-full hover:bg-red-50 transition-colors font-medium shadow-sm\"\r\n                >\r\n                    <RefreshCw className={`w-4 h-4 ${isRetrying ? 'animate-spin' : ''}`} />\r\n                    再試行する\r\n                </button>\r\n            </div>\r\n        );\r\n    }\r\n\r\n    // Personalized Score Calculation\r\n    const calculatePersonalizedScore = () => {\r\n        if (!place.axisScores || focusedAxes.length === 0) return null;\r\n\r\n        const scores = place.axisScores;\r\n        let totalScore = 0;\r\n        let totalWeight = 0;\r\n\r\n        const axesMap: Record<string, number> = {\r\n            'taste': scores.taste,\r\n            'service': scores.service,\r\n            'atmosphere': scores.atmosphere,\r\n            'cost': scores.cost\r\n        };\r\n\r\n        ['taste', 'service', 'atmosphere', 'cost'].forEach(axis => {\r\n            const score = axesMap[axis] || 0;\r\n            const weight = focusedAxes.includes(axis) ? 3 : 1;\r\n            totalScore += score * weight;\r\n            totalWeight += weight;\r\n        });\r\n\r\n        return totalScore / totalWeight;\r\n    };\r\n\r\n    const yourScore = calculatePersonalizedScore();\r\n\r\n    const data = place.axisScores ? [\r\n        { subject: '味', A: place.axisScores.taste, fullMark: 5 },\r\n        { subject: '接客', A: place.axisScores.service, fullMark: 5 },\r\n        { subject: '雰囲気', A: place.axisScores.atmosphere, fullMark: 5 },\r\n        { subject: 'コスパ', A: place.axisScores.cost, fullMark: 5 },\r\n    ] : [];\r\n\r\n    return (\r\n        <div className=\"w-full max-w-6xl mx-auto space-y-8 animate-in fade-in slide-in-from-bottom-4 duration-700\">\r\n\r\n            {/* Header Section: Name & Badges */}\r\n            <div className=\"bg-white rounded-3xl shadow-xl border border-slate-100 p-8 md:p-10\">\r\n                <div className=\"flex flex-col gap-6\">\r\n                    <div className=\"flex items-center gap-2 text-slate-500 text-sm font-medium\">\r\n                        <MapPin className=\"w-4 h-4\" />\r\n                        <span>Google Maps 掲載店</span>\r\n                    </div>\r\n                    <h2 className=\"text-4xl font-extrabold text-slate-900 tracking-tight leading-tight\">{place.name}</h2>\r\n\r\n                    {/* Badges */}\r\n                    <div className=\"flex flex-wrap gap-2\">\r\n                        {(() => {\r\n                            // 1. Try Price Range\r\n                            if (place.priceRange) {\r\n                                const start = place.priceRange.startPrice?.units;\r\n                                const end = place.priceRange.endPrice?.units;\r\n                                if (start || end) {\r\n                                    const label = `${start ? '¥' + Number(start).toLocaleString() : ''} ~ ${end ? '¥' + Number(end).toLocaleString() : ''}`;\r\n\r\n                                    let color = 'bg-slate-500 text-white shadow-sm';\r\n                                    let prefix = '';\r\n                                    const price = Number(start || end || 0);\r\n\r\n                                    if (price >= 10000) {\r\n                                        color = 'bg-rose-600 text-white shadow-sm shadow-rose-200';\r\n                                        prefix = '最高級';\r\n                                    } else if (price >= 3000) {\r\n                                        color = 'bg-orange-500 text-white shadow-sm shadow-orange-200';\r\n                                        prefix = '高級';\r\n                                    } else if (price >= 1000) {\r\n                                        color = 'bg-blue-500 text-white shadow-sm shadow-blue-200';\r\n                                        prefix = '標準';\r\n                                    } else {\r\n                                        color = 'bg-emerald-500 text-white shadow-sm shadow-emerald-200';\r\n                                        prefix = 'お手頃';\r\n                                    }\r\n\r\n                                    return (\r\n                                        <div className={`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-bold tracking-wide shadow-sm border ${color}`}>\r\n                                            <DollarSign className=\"w-3 h-3\" />\r\n                                            <span>{prefix} ({label})</span>\r\n                                        </div>\r\n                                    );\r\n                                }\r\n                            }\r\n\r\n                            // 2. Try Price Level\r\n                            const info = getPriceLevelInfo(place.priceLevel);\r\n                            if (!info) return null;\r\n                            return (\r\n                                <div className={`inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-bold tracking-wide shadow-sm border ${info.color}`}>\r\n                                    <DollarSign className=\"w-3 h-3\" />\r\n                                    <span>{info.label}</span>\r\n                                </div>\r\n                            );\r\n                        })()}\r\n                        {place.usageScores?.business && place.usageScores.business >= 4.0 && (\r\n                            <div className=\"inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-slate-800 text-white text-xs font-bold tracking-wide shadow-sm\">\r\n                                <Briefcase className=\"w-3 h-3\" />\r\n                                <span>ビジネス</span>\r\n                            </div>\r\n                        )}\r\n                        {place.usageScores?.date && place.usageScores.date >= 4.0 && (\r\n                            <div className=\"inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-rose-500 text-white text-xs font-bold tracking-wide shadow-sm shadow-rose-200\">\r\n                                <Heart className=\"w-3 h-3 fill-current\" />\r\n                                <span>デート</span>\r\n                            </div>\r\n                        )}\r\n                        {place.usageScores?.solo && place.usageScores.solo >= 4.0 && (\r\n                            <div className=\"inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-emerald-600 text-white text-xs font-bold tracking-wide shadow-sm shadow-emerald-200\">\r\n                                <User className=\"w-3 h-3\" />\r\n                                <span>お一人様</span>\r\n                            </div>\r\n                        )}\r\n                        {place.usageScores?.family && place.usageScores.family >= 4.0 && (\r\n                            <div className=\"inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-orange-500 text-white text-xs font-bold tracking-wide shadow-sm shadow-orange-200\">\r\n                                <Users className=\"w-3 h-3\" />\r\n                                <span>ファミリー</span>\r\n                            </div>\r\n                        )}\r\n                        {place.axisScores?.taste && place.axisScores.taste >= 4.5 && (\r\n                            <div className=\"inline-flex items-center gap-1.5 px-3 py-1 rounded-full bg-amber-400 text-white text-xs font-bold tracking-wide shadow-sm shadow-amber-200\">\r\n                                <Award className=\"w-3 h-3\" />\r\n                                <span>美食家認定</span>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Contact Info */}\r\n                    <div className=\"flex flex-col gap-2 text-sm text-slate-600 mt-2\">\r\n                        {place.address && (\r\n                            <div className=\"flex items-center gap-2\">\r\n                                <MapPin className=\"w-4 h-4 text-slate-400 shrink-0\" />\r\n                                <span>{place.address}</span>\r\n                            </div>\r\n                        )}\r\n\r\n                        <div className=\"flex items-center gap-2\">\r\n                            <Map className=\"w-4 h-4 text-slate-400 shrink-0\" />\r\n                            <a\r\n                                href={`https://www.google.com/maps/search/?api=1&query=Google&query_place_id=${place.id}`}\r\n                                target=\"_blank\"\r\n                                rel=\"noopener noreferrer\"\r\n                                className=\"text-blue-600 hover:underline\"\r\n                            >\r\n                                Google Mapで見る\r\n                            </a>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Last Updated */}\r\n                    <div className=\"flex items-center gap-2 text-slate-400 text-xs mt-2\">\r\n                        <RefreshCw className=\"w-3 h-3\" />\r\n                        <span className=\"tabular-nums\">最終更新: {formatDate(place.updatedAt)}</span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* Tabs */}\r\n            <div className=\"flex border-b border-gray-200 mb-8\">\r\n                <button\r\n                    onClick={() => setActiveTab('evaluation')}\r\n                    className={`px-6 py-3 text-sm font-medium transition-colors relative ${activeTab === 'evaluation'\r\n                        ? 'text-orange-600'\r\n                        : 'text-gray-500 hover:text-gray-700'\r\n                        }`}\r\n                >\r\n                    評価\r\n                    {activeTab === 'evaluation' && (\r\n                        <div className=\"absolute bottom-0 left-0 w-full h-0.5 bg-orange-600\" />\r\n                    )}\r\n                </button>\r\n                <button\r\n                    onClick={() => setActiveTab('map')}\r\n                    className={`px-6 py-3 text-sm font-medium transition-colors relative ${activeTab === 'map'\r\n                        ? 'text-orange-600'\r\n                        : 'text-gray-500 hover:text-gray-700'\r\n                        }`}\r\n                >\r\n                    地図\r\n                    {activeTab === 'map' && (\r\n                        <div className=\"absolute bottom-0 left-0 w-full h-0.5 bg-orange-600\" />\r\n                    )}\r\n                </button>\r\n            </div>\r\n\r\n            {/* Map Tab Content */}\r\n            {activeTab === 'map' && (\r\n                <div className=\"bg-white rounded-xl shadow-sm border border-slate-100 p-4 h-[500px] w-full\">\r\n                    {apiKey ? (\r\n                        <iframe\r\n                            width=\"100%\"\r\n                            height=\"100%\"\r\n                            style={{ border: 0, borderRadius: '0.75rem' }}\r\n                            loading=\"lazy\"\r\n                            allowFullScreen\r\n                            referrerPolicy=\"no-referrer-when-downgrade\"\r\n                            src={`https://www.google.com/maps/embed/v1/place?key=${apiKey}&q=place_id:${place.id}`}\r\n                        ></iframe>\r\n                    ) : (\r\n                        <div className=\"w-full h-full flex items-center justify-center bg-gray-50 text-gray-400\">\r\n                            <Loader2 className=\"w-8 h-8 animate-spin\" />\r\n                        </div>\r\n                    )}\r\n                </div>\r\n            )}\r\n\r\n            {/* Evaluation Tab Content */}\r\n            {activeTab === 'evaluation' && (\r\n                <>\r\n                    {/* Axis Selection Control */}\r\n                    <div className=\"mb-8 p-6 bg-slate-50 rounded-2xl border border-slate-100 flex flex-col items-center gap-4\">\r\n                        <p className=\"text-sm font-bold text-slate-500\">\r\n                            重視するポイントを選択してスコアをパーソナライズ（最大2つ）\r\n                        </p>\r\n                        <div className=\"flex flex-wrap gap-3 justify-center\">\r\n                            {[\r\n                                { id: 'taste', label: '味・料理', icon: Utensils },\r\n                                { id: 'service', label: '接客・サービス', icon: Heart },\r\n                                { id: 'atmosphere', label: '雰囲気・空間', icon: Sparkles },\r\n                                { id: 'cost', label: 'コスパ', icon: TrendingUp },\r\n                            ].map((axis) => {\r\n                                const isSelected = focusedAxes.includes(axis.id);\r\n                                return (\r\n                                    <button\r\n                                        key={axis.id}\r\n                                        onClick={() => onToggleAxis && onToggleAxis(axis.id)}\r\n                                        disabled={!onToggleAxis}\r\n                                        className={`\r\n                                       flex items-center gap-2 px-4 py-2 rounded-full text-sm font-bold transition-all duration-300 border shadow-sm\r\n                                       ${isSelected\r\n                                                ? 'bg-[#E65100] text-white border-[#E65100] transform scale-105 shadow-md'\r\n                                                : 'bg-white text-slate-600 border-slate-200 hover:border-[#E65100] hover:text-[#E65100]'\r\n                                            }\r\n                                     `}\r\n                                    >\r\n                                        <axis.icon className=\"w-4 h-4\" />\r\n                                        {axis.label}\r\n                                    </button>\r\n                                );\r\n                            })}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* Score Display (True Score vs Google Score) */}\r\n                    <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                        {/* True Score (Left - Prominent) */}\r\n                        {yourScore ? (\r\n                            <div className=\"bg-white p-6 rounded-xl shadow-lg border border-[#E65100] flex flex-col items-center justify-center relative overflow-hidden animate-in fade-in zoom-in-95 duration-300\">\r\n                                <div className=\"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-[#E65100] to-orange-500\"></div>\r\n                                <h3 className=\"text-[#E65100] font-bold mb-2\">あなたへのマッチ度</h3>\r\n                                <div className=\"flex items-baseline\">\r\n                                    <span className=\"text-7xl font-black text-[#E65100] tabular-nums tracking-tighter\">{yourScore.toFixed(1)}</span>\r\n                                    <span className=\"text-2xl text-orange-300 ml-1 font-bold\">/5.0</span>\r\n                                </div>\r\n                                <div className=\"flex items-center mt-2 text-orange-500\">\r\n                                    {[...Array(5)].map((_, i) => (\r\n                                        <Star\r\n                                            key={i}\r\n                                            className={`w-6 h-6 ${i < Math.round(yourScore) ? 'fill-current' : 'text-orange-200'}`}\r\n                                        />\r\n                                    ))}\r\n                                </div>\r\n                                <div className=\"mt-4 flex flex-col items-center gap-1\">\r\n                                    <p className=\"text-xs font-bold text-slate-400\">AI分析スコア</p>\r\n                                    <span className=\"text-xl font-bold text-slate-500\">{place.trueScore?.toFixed(1)}</span>\r\n                                </div>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"bg-white p-6 rounded-xl shadow-sm border border-orange-100 flex flex-col items-center justify-center relative overflow-hidden\">\r\n                                <div className=\"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-orange-400 to-red-500\"></div>\r\n                                <h3 className=\"text-gray-500 font-medium mb-2\">AI分析スコア</h3>\r\n                                <div className=\"flex items-baseline\">\r\n                                    <span className=\"text-6xl font-bold text-gray-900 tabular-nums\">{place.trueScore?.toFixed(1)}</span>\r\n                                    <span className=\"text-2xl text-gray-400 ml-1\">/5.0</span>\r\n                                </div>\r\n                                <div className=\"flex items-center mt-2 text-orange-500\">\r\n                                    {[...Array(5)].map((_, i) => (\r\n                                        <Star\r\n                                            key={i}\r\n                                            className={`w-6 h-6 ${i < Math.round(place.trueScore || 0) ? 'fill-current' : 'text-gray-200'}`}\r\n                                        />\r\n                                    ))}\r\n                                </div>\r\n                                <p className=\"text-xs text-gray-400 mt-4 text-center\">\r\n                                    ※信頼度の高い上位5件のレビューをもとに<br />スコアを算出しています\r\n                                </p>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Google Map Score (Right - Standard) */}\r\n                        <div className=\"bg-gray-50 p-6 rounded-xl border border-gray-200 flex flex-col items-center justify-center\">\r\n                            <h3 className=\"text-gray-500 font-medium mb-2\">Google Map Score</h3>\r\n                            <div className=\"flex items-baseline\">\r\n                                <span className=\"text-4xl font-bold text-gray-700 tabular-nums\">{place.originalRating.toFixed(1)}</span>\r\n                                <span className=\"text-xl text-gray-400 ml-1\">/5.0</span>\r\n                            </div>\r\n                            <div className=\"flex items-center mt-2 text-yellow-400\">\r\n                                {[...Array(5)].map((_, i) => (\r\n                                    <Star\r\n                                        key={i}\r\n                                        className={`w-5 h-5 ${i < Math.round(place.originalRating) ? 'fill-current' : 'text-gray-300'}`}\r\n                                    />\r\n                                ))}\r\n                            </div>\r\n                            <p className=\"text-sm text-gray-500 mt-2\">\r\n                                <span className=\"tabular-nums\">{place.userRatingsTotal.toLocaleString()}</span> 件の評価\r\n                            </p>\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* 1. Charts & Metrics */}\r\n                    <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\r\n                        {/* Radar Chart */}\r\n                        <div className=\"lg:col-span-1 bg-white rounded-3xl shadow-lg border border-slate-100 p-8 h-96\">\r\n                            <h3 className=\"text-lg font-bold text-slate-900 mb-6\">バランス分析</h3>\r\n                            <ResponsiveContainer width=\"100%\" height=\"100%\">\r\n                                <RadarChart cx=\"50%\" cy=\"45%\" outerRadius=\"70%\" data={data}>\r\n                                    <PolarGrid stroke=\"#e2e8f0\" />\r\n                                    <PolarAngleAxis dataKey=\"subject\" tick={{ fill: '#64748b', fontSize: 13, fontWeight: 600 }} />\r\n                                    <PolarRadiusAxis angle={30} domain={[0, 5]} tick={false} axisLine={false} />\r\n                                    <Radar\r\n                                        name=\"Score\"\r\n                                        dataKey=\"A\"\r\n                                        stroke=\"#f43f5e\"\r\n                                        strokeWidth={3}\r\n                                        fill=\"#f43f5e\"\r\n                                        fillOpacity={0.2}\r\n                                    />\r\n                                </RadarChart>\r\n                            </ResponsiveContainer>\r\n                        </div>\r\n\r\n                        {/* Metric Cards */}\r\n                        <div className=\"lg:col-span-2 grid grid-cols-1 md:grid-cols-2 gap-4\">\r\n                            <MetricCard icon={Coffee} label=\"味・品質\" value={place.axisScores?.taste} />\r\n                            <MetricCard icon={Smile} label=\"接客・サービス\" value={place.axisScores?.service} />\r\n                            <MetricCard icon={TrendingUp} label=\"雰囲気\" value={place.axisScores?.atmosphere} />\r\n                            <MetricCard icon={DollarSign} label=\"コストパフォーマンス\" value={place.axisScores?.cost} />\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* 2. Summary & Gap Reason */}\r\n                    <div className=\"space-y-6\">\r\n                        <div className=\"bg-white rounded-3xl shadow-lg border border-slate-100 p-8\">\r\n                            <h3 className=\"text-xl font-bold text-slate-900 mb-4\">AI分析サマリー</h3>\r\n                            <p className=\"text-lg text-slate-600 leading-relaxed\">{place.summary}</p>\r\n\r\n                            {place.gapReason && (\r\n                                <div className=\"mt-6 bg-amber-50 border border-amber-200 rounded-2xl p-6\">\r\n                                    <h4 className=\"flex items-center gap-2 font-bold text-amber-800 mb-2\">\r\n                                        <TrendingUp className=\"w-5 h-5\" />\r\n                                        スコア分析インサイト\r\n                                    </h4>\r\n                                    <p className=\"text-amber-900 text-sm leading-relaxed\">\r\n                                        {place.gapReason}\r\n                                    </p>\r\n                                </div>\r\n                            )}\r\n                        </div>\r\n                    </div>\r\n\r\n                    {/* 3. Detailed Analysis Matrix */}\r\n                    {place.axisAnalysis && (\r\n                        <div className=\"space-y-6\">\r\n                            <h3 className=\"text-2xl font-bold text-slate-900\">評価軸別 詳細分析</h3>\r\n                            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\r\n                                <AxisAnalysisCard\r\n                                    title=\"味・品質\"\r\n                                    icon={Coffee}\r\n                                    data={place.axisAnalysis.taste}\r\n                                    color=\"rose\"\r\n                                />\r\n                                <AxisAnalysisCard\r\n                                    title=\"接客・サービス\"\r\n                                    icon={Smile}\r\n                                    data={place.axisAnalysis.service}\r\n                                    color=\"blue\"\r\n                                />\r\n                                <AxisAnalysisCard\r\n                                    title=\"雰囲気\"\r\n                                    icon={TrendingUp}\r\n                                    data={place.axisAnalysis.atmosphere}\r\n                                    color=\"purple\"\r\n                                />\r\n                                <AxisAnalysisCard\r\n                                    title=\"コストパフォーマンス\"\r\n                                    icon={DollarSign}\r\n                                    data={place.axisAnalysis.cost}\r\n                                    color=\"emerald\"\r\n                                />\r\n                            </div>\r\n                        </div>\r\n                    )}\r\n\r\n                    {/* Usage Scores */}\r\n                    <div className=\"bg-white rounded-3xl shadow-lg border border-slate-100 p-8 md:p-10\">\r\n                        <h3 className=\"text-xl font-bold text-slate-900 mb-8\">どんなシーンにおすすめ？</h3>\r\n                        <div className=\"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6\">\r\n                            <UsageCard label=\"ビジネス\" subLabel=\"接待・会食\" value={place.usageScores?.business} />\r\n                            <UsageCard label=\"デート\" subLabel=\"記念日・カップル\" value={place.usageScores?.date} />\r\n                            <UsageCard label=\"お一人様\" subLabel=\"ランチ・サク飲み\" value={place.usageScores?.solo} />\r\n                            <UsageCard label=\"ファミリー\" subLabel=\"お子様連れ\" value={place.usageScores?.family} />\r\n                            <UsageCard label=\"団体利用\" subLabel=\"宴会・飲み会\" value={place.usageScores?.group} />\r\n                        </div>\r\n                        {place.usageSummary && (\r\n                            <div className=\"mt-6 bg-slate-50 border border-slate-200 rounded-2xl p-4 text-sm text-slate-600 leading-relaxed\">\r\n                                <span className=\"font-bold text-slate-700 mr-2\">💡 シーン分析:</span>\r\n                                {place.usageSummary}\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n\r\n                    {/* Basic Info Section */}\r\n                    <BasicInfoSection place={place} />\r\n                </>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction BasicInfoSection({ place }: { place: Place }) {\r\n    const { detailedInfo } = place;\r\n    if (!detailedInfo) return null;\r\n\r\n    const { paymentOptions, serviceOptions, offerings, amenities, diningOptions } = detailedInfo;\r\n\r\n    return (\r\n        <div className=\"bg-white rounded-3xl shadow-lg border border-slate-100 p-8 md:p-10\">\r\n            <h3 className=\"text-xl font-bold text-slate-900 mb-8\">基本情報</h3>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8\">\r\n\r\n                {/* Service Options */}\r\n                <InfoGroup title=\"サービスオプション\" icon={Utensils}>\r\n                    <InfoItem label=\"デリバリー\" value={serviceOptions?.delivery} />\r\n                    <InfoItem label=\"テイクアウト\" value={serviceOptions?.takeout} />\r\n                    <InfoItem label=\"イートイン\" value={serviceOptions?.dineIn} />\r\n                    <InfoItem label=\"予約可\" value={serviceOptions?.reservable} />\r\n                </InfoGroup>\r\n\r\n                {/* Offerings */}\r\n                <InfoGroup title=\"提供メニュー\" icon={Wine}>\r\n                    <InfoItem label=\"アルコール\" value={offerings?.servesBeer || offerings?.servesWine} />\r\n                    <InfoItem label=\"ベジタリアン料理\" value={offerings?.servesVegetarianFood} />\r\n                    <InfoItem label=\"コーヒー\" value={offerings?.servesCoffee} />\r\n                    <InfoItem label=\"朝食\" value={diningOptions?.servesBreakfast} />\r\n                    <InfoItem label=\"ランチ\" value={diningOptions?.servesLunch} />\r\n                    <InfoItem label=\"ディナー\" value={diningOptions?.servesDinner} />\r\n                </InfoGroup>\r\n\r\n                {/* Amenities */}\r\n                <InfoGroup title=\"設備・環境\" icon={Accessibility}>\r\n                    <InfoItem label=\"トイレ\" value={amenities?.restroom} />\r\n                    <InfoItem label=\"子供連れOK\" value={amenities?.goodForChildren} />\r\n                    <InfoItem label=\"団体OK\" value={amenities?.goodForGroups} />\r\n                </InfoGroup>\r\n\r\n                {/* Payment Options */}\r\n                <InfoGroup title=\"決済方法\" icon={CreditCard}>\r\n                    {paymentOptions && paymentOptions.length > 0 ? (\r\n                        <div className=\"flex flex-wrap gap-2\">\r\n                            {paymentOptions.map((p, i) => (\r\n                                <span key={i} className=\"px-2 py-1 bg-slate-100 text-slate-600 text-xs rounded-md border border-slate-200\">\r\n                                    {formatPaymentOption(p)}\r\n                                </span>\r\n                            ))}\r\n                        </div>\r\n                    ) : (\r\n                        <span className=\"text-sm text-slate-400\">情報なし</span>\r\n                    )}\r\n                </InfoGroup>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction InfoGroup({ title, icon: Icon, children }: any) {\r\n    return (\r\n        <div className=\"space-y-4\">\r\n            <div className=\"flex items-center gap-2 text-slate-800 font-bold border-b border-slate-100 pb-2\">\r\n                <Icon className=\"w-5 h-5 text-slate-400\" />\r\n                <h4>{title}</h4>\r\n            </div>\r\n            <div className=\"space-y-2 pl-2\">\r\n                {children}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction InfoItem({ label, value }: { label: string, value?: boolean }) {\r\n    if (value === undefined) return null;\r\n    return (\r\n        <div className=\"flex items-center gap-2 text-sm\">\r\n            {value ? (\r\n                <Check className=\"w-4 h-4 text-emerald-500 shrink-0\" />\r\n            ) : (\r\n                <X className=\"w-4 h-4 text-slate-300 shrink-0\" />\r\n            )}\r\n            <span className={value ? 'text-slate-700 font-medium' : 'text-slate-400'}>{label}</span>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction formatPaymentOption(option: string): string {\r\n    // Simple formatter, can be expanded\r\n    return option.replace(/_/g, ' ').replace('PAYMENT_OPTION_', '');\r\n}\r\n\r\nfunction UsageCard({ label, subLabel, value }: any) {\r\n    const score = value || 0;\r\n    const isHigh = score >= 4.0;\r\n\r\n    return (\r\n        <div className={`group p-6 rounded-2xl border-2 transition-all duration-300 hover:shadow-lg ${isHigh ? 'bg-white border-rose-100 hover:border-rose-200' : 'bg-slate-50 border-transparent'}`}>\r\n            <div className=\"flex justify-between items-start mb-4\">\r\n                <div>\r\n                    <div className=\"text-slate-900 font-bold text-lg\">{label}</div>\r\n                    <div className=\"text-xs text-slate-500 mt-1\">{subLabel}</div>\r\n                </div>\r\n                <div className={`text-2xl font-black ${isHigh ? 'text-rose-500' : 'text-slate-300'}`}>\r\n                    {score.toFixed(1)}\r\n                </div>\r\n            </div>\r\n            <div className=\"h-2 bg-slate-100 rounded-full overflow-hidden\">\r\n                <div\r\n                    className={`h-full rounded-full transition-all duration-1000 ${isHigh ? 'bg-rose-500' : 'bg-slate-300'}`}\r\n                    style={{ width: `${(score / 5) * 100}%` }}\r\n                ></div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction MetricCard({ icon: Icon, label, value }: any) {\r\n    return (\r\n        <div className=\"bg-white p-6 rounded-2xl border border-slate-100 shadow-sm hover:shadow-md transition-shadow flex items-start gap-4\">\r\n            <div className=\"p-3 rounded-xl bg-slate-50 text-slate-700\">\r\n                <Icon className=\"w-6 h-6\" />\r\n            </div>\r\n            <div className=\"flex-1\">\r\n                <div className=\"flex justify-between items-center mb-1\">\r\n                    <h4 className=\"font-bold text-slate-900\">{label}</h4>\r\n                    <span className=\"text-2xl font-black text-slate-900\">{value?.toFixed(1)}</span>\r\n                </div>\r\n                <div className=\"h-2 bg-slate-100 rounded-full overflow-hidden\">\r\n                    <div\r\n                        className=\"h-full bg-slate-900 rounded-full transition-all duration-1000\"\r\n                        style={{ width: `${(value / 5) * 100}%` }}\r\n                    ></div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction AxisAnalysisCard({ title, icon: Icon, data, color }: any) {\r\n    const colorClasses: any = {\r\n        rose: { bg: 'bg-rose-50', border: 'border-rose-100', text: 'text-rose-800', dot: 'bg-rose-500' },\r\n        blue: { bg: 'bg-blue-50', border: 'border-blue-100', text: 'text-blue-800', dot: 'bg-blue-500' },\r\n        purple: { bg: 'bg-purple-50', border: 'border-purple-100', text: 'text-purple-800', dot: 'bg-purple-500' },\r\n        emerald: { bg: 'bg-emerald-50', border: 'border-emerald-100', text: 'text-emerald-800', dot: 'bg-emerald-500' },\r\n    };\r\n    const c = colorClasses[color] || colorClasses.rose;\r\n\r\n    return (\r\n        <div className={`rounded-3xl border ${c.bg} ${c.border} p-6 h-full`}>\r\n            <div className=\"flex items-center gap-3 mb-4\">\r\n                <div className={`p-2 rounded-xl bg-white/60 ${c.text}`}>\r\n                    <Icon className=\"w-5 h-5\" />\r\n                </div>\r\n                <h4 className={`font-bold text-lg ${c.text}`}>{title}</h4>\r\n            </div>\r\n\r\n            <p className=\"text-sm text-slate-700 font-medium mb-4 leading-relaxed bg-white/50 p-3 rounded-xl\">\r\n                {data?.summary}\r\n            </p>\r\n\r\n            <div className=\"space-y-4\">\r\n                <div>\r\n                    <div className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 flex items-center gap-1\">\r\n                        <Smile className=\"w-3 h-3\" /> 評価ポイント\r\n                    </div>\r\n                    <ul className=\"space-y-2\">\r\n                        {data?.pros?.map((p: string, i: number) => (\r\n                            <li key={i} className=\"flex items-start gap-2 text-sm text-slate-700\">\r\n                                <span className={`mt-1.5 w-1.5 h-1.5 rounded-full ${c.dot} shrink-0`} />\r\n                                {p}\r\n                            </li>\r\n                        ))}\r\n                    </ul>\r\n                </div>\r\n                <div>\r\n                    <div className=\"text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 flex items-center gap-1\">\r\n                        <TrendingUp className=\"w-3 h-3 rotate-180\" /> 懸念ポイント\r\n                    </div>\r\n                    <ul className=\"space-y-2\">\r\n                        {data?.cons?.map((c: string, i: number) => (\r\n                            <li key={i} className=\"flex items-start gap-2 text-sm text-slate-700\">\r\n                                <span className=\"mt-1.5 w-1.5 h-1.5 rounded-full bg-slate-400 shrink-0\" />\r\n                                {c}\r\n                            </li>\r\n                        ))}\r\n                    </ul>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nfunction formatDate(date: any): string {\r\n    if (!date) return '不明';\r\n    try {\r\n        // Handle Firestore Timestamp (seconds, nanoseconds)\r\n        if (date.seconds) {\r\n            return new Date(date.seconds * 1000).toLocaleDateString('ja-JP');\r\n        }\r\n        // Handle string or Date object\r\n        return new Date(date).toLocaleDateString('ja-JP');\r\n    } catch (e) {\r\n        return '不明';\r\n    }\r\n}\r\n\r\n\r\n\r\nfunction getPriceLevelInfo(level: string | undefined) {\r\n    switch (level) {\r\n        case 'PRICE_LEVEL_FREE': return { label: '無料', color: 'bg-slate-500 text-white shadow-sm' };\r\n        case 'PRICE_LEVEL_INEXPENSIVE': return { label: 'お手頃 (~1,000円)', color: 'bg-emerald-500 text-white shadow-sm shadow-emerald-200' };\r\n        case 'PRICE_LEVEL_MODERATE': return { label: '標準 (1,000円~3,000円)', color: 'bg-blue-500 text-white shadow-sm shadow-blue-200' };\r\n        case 'PRICE_LEVEL_EXPENSIVE': return { label: '高級 (3,000円~10,000円)', color: 'bg-orange-500 text-white shadow-sm shadow-orange-200' };\r\n        case 'PRICE_LEVEL_VERY_EXPENSIVE': return { label: '最高級 (10,000円~)', color: 'bg-rose-600 text-white shadow-sm shadow-rose-200' };\r\n        default: return null;\r\n    }\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2272, "column": 0}, "map": {"version":3,"sources":["file:///app/src/components/ui/ListingCard.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { Star } from 'lucide-react';\r\n\r\ninterface ListingCardProps {\r\n    title: string;\r\n    location: string;\r\n    rating: number;\r\n    price?: string;\r\n    distance?: string;\r\n    imageUrl: string;\r\n    tags?: string[];\r\n    onClick?: () => void;\r\n}\r\n\r\nexport default function ListingCard({\r\n    title,\r\n    location,\r\n    rating,\r\n    price,\r\n    imageUrl,\r\n    tags,\r\n    onClick\r\n}: ListingCardProps) {\r\n    return (\r\n        <div\r\n            className=\"group cursor-pointer flex flex-col gap-4\"\r\n            onClick={onClick}\r\n        >\r\n            <div className=\"relative aspect-[4/3] w-full overflow-hidden rounded-sm bg-gray-100\">\r\n                {/* 画像表示エリア */}\r\n                {imageUrl ? (\r\n                    <img\r\n                        src={imageUrl}\r\n                        alt={title}\r\n                        className=\"h-full w-full object-cover transition-transform duration-700 group-hover:scale-110\"\r\n                    />\r\n                ) : (\r\n                    <div className=\"flex h-full w-full items-center justify-center bg-gray-200 text-gray-400\">\r\n                        No Image\r\n                    </div>\r\n                )}\r\n\r\n                {/* オーバーレイグラデーション（ホバー時の視認性向上） */}\r\n                <div className=\"absolute inset-0 bg-gradient-to-t from-black/40 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300\" />\r\n            </div>\r\n\r\n            <div className=\"flex flex-col gap-1\">\r\n                {/* タグリスト */}\r\n                {tags && tags.length > 0 && (\r\n                    <div className=\"flex gap-2 mb-1\">\r\n                        {tags.map((tag, i) => (\r\n                            <span key={i} className=\"text-[10px] uppercase tracking-wider font-medium text-[#E65100] border border-[#E65100]/20 px-2 py-0.5 rounded-full\">\r\n                                {tag}\r\n                            </span>\r\n                        ))}\r\n                    </div>\r\n                )}\r\n\r\n                <div className=\"flex justify-between items-baseline\">\r\n                    <h3 className=\"text-lg font-serif font-bold text-gray-900 group-hover:text-[#E65100] transition-colors duration-300 line-clamp-1\">\r\n                        {title}\r\n                    </h3>\r\n                    <div className=\"flex items-center gap-1 shrink-0 bg-[#FAFAFA] px-2 py-0.5 rounded-full border border-gray-100\">\r\n                        <Star className=\"w-3 h-3 fill-[#C5A059] text-[#C5A059]\" />\r\n                        <span className=\"text-sm font-medium text-gray-700\">{rating.toFixed(2)}</span>\r\n                    </div>\r\n                </div>\r\n\r\n                <div className=\"flex justify-between items-center text-sm text-gray-500 font-sans\">\r\n                    <p>{location}</p>\r\n                    <p className=\"font-medium text-gray-900\">{price}</p>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAEA;AAFA;;;AAee,SAAS,YAAY,EAChC,KAAK,EACL,QAAQ,EACR,MAAM,EACN,KAAK,EACL,QAAQ,EACR,IAAI,EACJ,OAAO,EACQ;IACf,qBACI,8OAAC;QACG,WAAU;QACV,SAAS;;0BAET,8OAAC;gBAAI,WAAU;;oBAEV,yBACG,8OAAC;wBACG,KAAK;wBACL,KAAK;wBACL,WAAU;;;;;6CAGd,8OAAC;wBAAI,WAAU;kCAA2E;;;;;;kCAM9F,8OAAC;wBAAI,WAAU;;;;;;;;;;;;0BAGnB,8OAAC;gBAAI,WAAU;;oBAEV,QAAQ,KAAK,MAAM,GAAG,mBACnB,8OAAC;wBAAI,WAAU;kCACV,KAAK,GAAG,CAAC,CAAC,KAAK,kBACZ,8OAAC;gCAAa,WAAU;0CACnB;+BADM;;;;;;;;;;kCAOvB,8OAAC;wBAAI,WAAU;;0CACX,8OAAC;gCAAG,WAAU;0CACT;;;;;;0CAEL,8OAAC;gCAAI,WAAU;;kDACX,8OAAC,0MAAI;wCAAC,WAAU;;;;;;kDAChB,8OAAC;wCAAK,WAAU;kDAAqC,OAAO,OAAO,CAAC;;;;;;;;;;;;;;;;;;kCAI5E,8OAAC;wBAAI,WAAU;;0CACX,8OAAC;0CAAG;;;;;;0CACJ,8OAAC;gCAAE,WAAU;0CAA6B;;;;;;;;;;;;;;;;;;;;;;;;AAK9D"}},
    {"offset": {"line": 2418, "column": 0}, "map": {"version":3,"sources":["file:///app/src/components/PlaceListItem.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { PlaceSearchResult } from '@/server/actions/place';\r\nimport { Star, MapPin, ChevronRight, Loader2 } from 'lucide-react';\r\nimport { useEffect, useState } from 'react';\r\nimport { doc, onSnapshot } from 'firebase/firestore';\r\nimport { firestore } from '@/lib/firebase/client';\r\nimport { Place } from '@/types/schema';\r\n\r\ninterface PlaceListItemProps {\r\n    initialPlace: PlaceSearchResult;\r\n    onSelect: (placeId: string) => void;\r\n    focusedAxes?: string[];\r\n}\r\n\r\nexport default function PlaceListItem({ initialPlace, onSelect, focusedAxes = [] }: PlaceListItemProps) {\r\n    const [placeData, setPlaceData] = useState<Place | null>(null);\r\n\r\n    useEffect(() => {\r\n        const unsubscribe = onSnapshot(doc(firestore, 'places', initialPlace.id), (docSnapshot) => {\r\n            if (docSnapshot.exists()) {\r\n                setPlaceData({ ...docSnapshot.data() as Place, id: docSnapshot.id });\r\n            }\r\n        });\r\n        return () => unsubscribe();\r\n    }, [initialPlace.id]);\r\n\r\n    const displayPlace = placeData ? {\r\n        ...initialPlace,\r\n        ...placeData,\r\n        // Ensure we prioritize the latest data if available, but fallback to initial for basics\r\n    } : initialPlace;\r\n\r\n    const isAnalyzed = placeData?.trueScore != null;\r\n    const isAnalyzing = placeData?.status === 'processing' || (!isAnalyzed && placeData?.status !== 'error' && placeData?.status !== 'completed'); // Simplified check\r\n\r\n    // Personalized Score Calculation\r\n    const calculatePersonalizedScore = () => {\r\n        if (!placeData?.axisScores || focusedAxes.length === 0) return null;\r\n\r\n        const scores = placeData.axisScores;\r\n        let totalScore = 0;\r\n        let totalWeight = 0;\r\n\r\n        const axesMap: Record<string, number> = {\r\n            'taste': scores.taste,\r\n            'service': scores.service,\r\n            'atmosphere': scores.atmosphere,\r\n            'cost': scores.cost\r\n        };\r\n\r\n        // Standard Axes (Taste, Service, Atmosphere, Cost)\r\n        ['taste', 'service', 'atmosphere', 'cost'].forEach(axis => {\r\n            const score = axesMap[axis] || 0;\r\n            const weight = focusedAxes.includes(axis) ? 3 : 1;\r\n            totalScore += score * weight;\r\n            totalWeight += weight;\r\n        });\r\n\r\n        return totalScore / totalWeight;\r\n    };\r\n\r\n    const yourScore = calculatePersonalizedScore();\r\n\r\n    return (\r\n        <div\r\n            onClick={() => onSelect(initialPlace.id)}\r\n            className=\"bg-white rounded-2xl p-6 shadow-sm hover:shadow-xl border border-slate-100 transition-all duration-300 cursor-pointer group flex flex-col h-full\"\r\n        >\r\n            <div className=\"flex justify-between items-start mb-4\">\r\n                <h3 className=\"text-xl font-bold text-slate-900 group-hover:text-orange-600 transition-colors line-clamp-1 flex-grow pr-2\">\r\n                    {displayPlace.name}\r\n                </h3>\r\n                <div className=\"flex flex-col items-end shrink-0 ml-2\">\r\n                    <div className=\"text-xs text-slate-400 font-bold mb-0.5\">Google Map Score</div>\r\n                    <div className=\"flex items-center bg-slate-50 px-2 py-1 rounded-lg border border-slate-100\">\r\n                        <Star className=\"w-4 h-4 text-yellow-400 fill-yellow-400 mr-1\" />\r\n                        <span className=\"font-bold text-slate-700\">{displayPlace.rating || initialPlace.rating}</span>\r\n                        <span className=\"text-xs text-slate-400 ml-1\">({displayPlace.userRatingsTotal || initialPlace.userRatingsTotal})</span>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n\r\n            {/* AI Analysis Score Badge */}\r\n            <div className=\"mb-4 p-4 bg-slate-50 rounded-xl border border-slate-100 relative overflow-hidden\">\r\n                {isAnalyzed ? (\r\n                    <div className=\"flex flex-col gap-3\">\r\n                        {/* Personalized Score Display (Prominent if active) */}\r\n                        {yourScore ? (\r\n                            <div className=\"animate-in fade-in slide-in-from-top-2 duration-300\">\r\n                                <div className=\"flex items-center justify-between mb-2\">\r\n                                    <div>\r\n                                        <span className=\"text-base font-bold text-[#E65100] block mb-1\">あなたへのマッチ度</span>\r\n                                        <div className=\"flex items-baseline gap-2\">\r\n                                            <span className=\"text-3xl font-black text-[#E65100]\">\r\n                                                {yourScore.toFixed(1)}\r\n                                            </span>\r\n                                            <div className=\"flex text-orange-500\">\r\n                                                {[...Array(5)].map((_, i) => (\r\n                                                    <Star\r\n                                                        key={i}\r\n                                                        className={`w-5 h-5 ${i < Math.round(yourScore) ? 'fill-current' : 'text-gray-300'}`}\r\n                                                    />\r\n                                                ))}\r\n                                            </div>\r\n                                        </div>\r\n                                    </div>\r\n                                    {/* Standard AI Score (Secondary) */}\r\n                                    <div className=\"text-right opacity-75\">\r\n                                        <span className=\"text-xs font-bold text-slate-400 block\">AI分析スコア</span>\r\n                                        <span className=\"text-lg font-bold text-slate-600\">\r\n                                            {placeData!.trueScore?.toFixed(1)}\r\n                                        </span>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        ) : (\r\n                            <div className=\"flex items-center justify-between\">\r\n                                <div>\r\n                                    <span className=\"text-base font-bold text-slate-500 block mb-1\">AI分析スコア</span>\r\n                                    <div className=\"flex items-baseline gap-2\">\r\n                                        <span className=\"text-xl font-black text-[#E65100]\">\r\n                                            {placeData!.trueScore!.toFixed(1)}\r\n                                        </span>\r\n                                        <div className=\"flex text-orange-500\">\r\n                                            {[...Array(5)].map((_, i) => (\r\n                                                <Star\r\n                                                    key={i}\r\n                                                    className={`w-4 h-4 ${i < Math.round(placeData!.trueScore || 0) ? 'fill-current' : 'text-gray-300'}`}\r\n                                                />\r\n                                            ))}\r\n                                        </div>\r\n                                    </div>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n\r\n                        {/* Axis Scores */}\r\n                        {placeData?.axisScores && (\r\n                            <div className=\"grid grid-cols-4 gap-2 pt-3 border-t border-slate-200\">\r\n                                <div className=\"text-center\">\r\n                                    <div className={`text-xs font-medium mb-0.5 ${focusedAxes.includes('taste') ? 'text-[#E65100] font-bold' : 'text-slate-500'}`}>味</div>\r\n                                    <div className={`text-base font-bold ${focusedAxes.includes('taste') ? 'text-[#E65100]' : 'text-slate-700'}`}>{placeData.axisScores.taste.toFixed(1)}</div>\r\n                                </div>\r\n                                <div className=\"text-center\">\r\n                                    <div className={`text-xs font-medium mb-0.5 ${focusedAxes.includes('service') ? 'text-[#E65100] font-bold' : 'text-slate-500'}`}>接客</div>\r\n                                    <div className={`text-base font-bold ${focusedAxes.includes('service') ? 'text-[#E65100]' : 'text-slate-700'}`}>{placeData.axisScores.service.toFixed(1)}</div>\r\n                                </div>\r\n                                <div className=\"text-center\">\r\n                                    <div className={`text-xs font-medium mb-0.5 ${focusedAxes.includes('atmosphere') ? 'text-[#E65100] font-bold' : 'text-slate-500'}`}>雰囲気</div>\r\n                                    <div className={`text-base font-bold ${focusedAxes.includes('atmosphere') ? 'text-[#E65100]' : 'text-slate-700'}`}>{placeData.axisScores.atmosphere.toFixed(1)}</div>\r\n                                </div>\r\n                                <div className=\"text-center\">\r\n                                    <div className={`text-xs font-medium mb-0.5 ${focusedAxes.includes('cost') ? 'text-[#E65100] font-bold' : 'text-slate-500'}`}>コスパ</div>\r\n                                    <div className={`text-base font-bold ${focusedAxes.includes('cost') ? 'text-[#E65100]' : 'text-slate-700'}`}>{placeData.axisScores.cost.toFixed(1)}</div>\r\n                                </div>\r\n                            </div>\r\n                        )}\r\n                    </div>\r\n                ) : (\r\n                    <div className=\"flex items-center justify-center py-4 gap-2 text-slate-400\">\r\n                        <div className=\"relative\">\r\n                            <Loader2 className=\"w-5 h-5 animate-spin text-orange-500\" />\r\n                        </div>\r\n                        <span className=\"text-sm font-medium\">AI分析中...</span>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"flex-grow\">\r\n                {/* Address */}\r\n                {(placeData?.address || initialPlace.vicinity) && (\r\n                    <div className=\"flex items-start text-slate-500 text-sm mb-4\">\r\n                        <MapPin className=\"w-4 h-4 mr-1 mt-0.5 shrink-0\" />\r\n                        <span className=\"line-clamp-2\">{placeData?.address || initialPlace.vicinity}</span>\r\n                    </div>\r\n                )}\r\n            </div>\r\n\r\n            <div className=\"flex justify-end mt-4 pt-4 border-t border-slate-50\">\r\n                <span className=\"text-sm font-bold text-slate-400 group-hover:text-orange-500 flex items-center transition-colors\">\r\n                    詳細を見る <ChevronRight className=\"w-4 h-4 ml-1\" />\r\n                </span>\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 2925, "column": 0}, "map": {"version":3,"sources":["file:///app/src/components/PlaceList.tsx"],"sourcesContent":["'use client';\r\n\r\nimport { PlaceSearchResult } from '@/server/actions/place';\r\nimport PlaceListItem from './PlaceListItem';\r\n\r\ninterface PlaceListProps {\r\n    places: PlaceSearchResult[];\r\n    onSelect: (placeId: string) => void;\r\n    onLoadMore: () => void;\r\n    hasMore: boolean;\r\n    loadingMore: boolean;\r\n    focusedAxes?: string[];\r\n}\r\n\r\n// 検索結果のリストを表示するコンポーネント\r\nexport default function PlaceList({ places, onSelect, onLoadMore, hasMore, loadingMore, focusedAxes }: PlaceListProps) {\r\n    return (\r\n        <div className=\"w-full max-w-6xl mx-auto px-4 py-8\">\r\n            <div className=\"mb-6\">\r\n                <h2 className=\"text-2xl font-bold text-slate-900 mb-1\">検索結果</h2>\r\n                <p className=\"text-sm text-slate-500\">\r\n                    検索キーワードに関連度の高い上位20件を表示しています\r\n                </p>\r\n            </div>\r\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-8 mb-8\">\r\n                {places.map((place) => (\r\n                    <PlaceListItem\r\n                        key={place.id}\r\n                        initialPlace={place}\r\n                        onSelect={onSelect}\r\n                        focusedAxes={focusedAxes}\r\n                    />\r\n                ))}\r\n            </div>\r\n\r\n            {hasMore && (\r\n                <div className=\"flex justify-center mt-8 pb-12\">\r\n                    <button\r\n                        onClick={onLoadMore}\r\n                        disabled={loadingMore}\r\n                        className=\"px-8 py-3 bg-white border border-slate-200 text-slate-600 font-medium rounded-full hover:bg-slate-50 hover:border-orange-500 hover:text-orange-600 transition-all duration-300 shadow-sm disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-2\"\r\n                    >\r\n                        {loadingMore ? (\r\n                            <>\r\n                                <div className=\"w-4 h-4 border-2 border-slate-400 border-t-transparent rounded-full animate-spin\" />\r\n                                読み込み中...\r\n                            </>\r\n                        ) : (\r\n                            <>\r\n                                もっと見る\r\n                            </>\r\n                        )}\r\n                    </button>\r\n                </div>\r\n            )}\r\n        </div>\r\n    );\r\n}\r\n"],"names":[],"mappings":";;;;;AAGA;AAHA;;;AAee,SAAS,UAAU,EAAE,MAAM,EAAE,QAAQ,EAAE,UAAU,EAAE,OAAO,EAAE,WAAW,EAAE,WAAW,EAAkB;IACjH,qBACI,8OAAC;QAAI,WAAU;;0BACX,8OAAC;gBAAI,WAAU;;kCACX,8OAAC;wBAAG,WAAU;kCAAyC;;;;;;kCACvD,8OAAC;wBAAE,WAAU;kCAAyB;;;;;;;;;;;;0BAI1C,8OAAC;gBAAI,WAAU;0BACV,OAAO,GAAG,CAAC,CAAC,sBACT,8OAAC,8IAAa;wBAEV,cAAc;wBACd,UAAU;wBACV,aAAa;uBAHR,MAAM,EAAE;;;;;;;;;;YAQxB,yBACG,8OAAC;gBAAI,WAAU;0BACX,cAAA,8OAAC;oBACG,SAAS;oBACT,UAAU;oBACV,WAAU;8BAET,4BACG;;0CACI,8OAAC;gCAAI,WAAU;;;;;;4BAAqF;;qDAIxG;kCAAE;;;;;;;;;;;;;;;;;;AAS9B"}},
    {"offset": {"line": 3020, "column": 0}, "map": {"version":3,"sources":["file:///app/src/server/actions/place.ts"],"sourcesContent":["'use server';\r\n\r\nimport { GoogleAuth } from 'google-auth-library';\r\nimport { getFirestore } from '@/lib/firebase/admin';\r\nimport { enqueueAnalysis } from '@/lib/queue/client';\r\nimport { Place } from '@/types/schema';\r\n\r\nexport async function searchAndAnalyze(query: string): Promise<string> {\r\n    console.log(`Analyzing place: ${query}`);\r\n    const placeId = query; // In the new flow, query is the placeId\r\n\r\n    const docRef = getFirestore().collection('places').doc(placeId);\r\n    const doc = await docRef.get();\r\n\r\n    if (doc.exists) {\r\n        const data = doc.data() as Place;\r\n        console.log(`Place ${placeId} found. Status: ${data.status}`);\r\n\r\n        // Check for expiration (30 days)\r\n        const now = new Date();\r\n        const updatedAt = data.updatedAt ? (data.updatedAt as any).toDate() : new Date(0); // Handle Firestore Timestamp\r\n        const diffTime = Math.abs(now.getTime() - updatedAt.getTime());\r\n        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n\r\n        if (diffDays > 30) {\r\n            console.log(`Place ${placeId} data is expired (${diffDays} days old). Re-fetching...`);\r\n            // Fall through to fetch logic\r\n        } else if (data.status === 'error') {\r\n            await enqueueAnalysis(placeId);\r\n            return placeId;\r\n        } else {\r\n            return placeId;\r\n        }\r\n    }\r\n\r\n    // If we are here, it means either doc doesn't exist OR it's expired.\r\n    // We need to fetch from Google Places API.\r\n    console.log(`Fetching fresh data for place ${placeId}...`);\r\n\r\n    try {\r\n        const auth = new GoogleAuth({\r\n            scopes: 'https://www.googleapis.com/auth/cloud-platform'\r\n        });\r\n        const client = await auth.getClient();\r\n        const token = await client.getAccessToken();\r\n\r\n        const baseUrl = `https://places.googleapis.com/v1/places/${placeId}?languageCode=ja`;\r\n        const headers = {\r\n            'Content-Type': 'application/json',\r\n            'Authorization': `Bearer ${token.token}`,\r\n            'X-Goog-FieldMask': 'id,displayName,formattedAddress,rating,userRatingCount,reviews,priceLevel,priceRange,paymentOptions,delivery,takeout,dineIn,reservable,servesBeer,servesWine,servesVegetarianFood,servesCoffee,servesBreakfast,servesLunch,servesDinner,goodForChildren,goodForGroups,restroom,accessibilityOptions'\r\n        };\r\n\r\n        const response = await fetch(baseUrl, { method: 'GET', headers });\r\n\r\n        if (!response.ok) {\r\n            const errorText = await response.text();\r\n            console.error('Google Places API Details Error:', errorText);\r\n            throw new Error(`Google Places API Error: ${response.statusText}`);\r\n        }\r\n\r\n        const data = await response.json();\r\n        console.log('API Response Data:', JSON.stringify(data, null, 2));\r\n\r\n        // Extract reviews\r\n        const reviews = data.reviews?.map((r: any) => r.text?.text).filter(Boolean) || [];\r\n\r\n        console.log(`Fetched reviews: ${reviews.length}`);\r\n\r\n        const newPlace: Place = {\r\n            id: data.id,\r\n            name: data.displayName?.text || 'Unknown',\r\n            address: data.formattedAddress,\r\n            originalRating: data.rating || 0,\r\n            userRatingsTotal: data.userRatingCount || 0,\r\n            ...(data.priceLevel ? { priceLevel: data.priceLevel } : {}),\r\n            ...(data.priceRange ? { priceRange: data.priceRange } : {}),\r\n            reviews: reviews,\r\n            detailedInfo: {\r\n                paymentOptions: data.paymentOptions,\r\n                serviceOptions: {\r\n                    delivery: data.delivery,\r\n                    takeout: data.takeout,\r\n                    dineIn: data.dineIn,\r\n                    reservable: data.reservable\r\n                },\r\n                offerings: {\r\n                    servesBeer: data.servesBeer,\r\n                    servesWine: data.servesWine,\r\n                    servesVegetarianFood: data.servesVegetarianFood,\r\n                    servesCoffee: data.servesCoffee\r\n                },\r\n                diningOptions: {\r\n                    servesBreakfast: data.servesBreakfast,\r\n                    servesLunch: data.servesLunch,\r\n                    servesDinner: data.servesDinner\r\n                },\r\n                amenities: {\r\n                    restroom: data.restroom,\r\n                    goodForChildren: data.goodForChildren,\r\n                    goodForGroups: data.goodForGroups\r\n                },\r\n            },\r\n            status: 'pending',\r\n            createdAt: doc.exists ? (doc.data() as Place).createdAt : new Date(), // Keep original createdAt if exists\r\n            updatedAt: new Date(),\r\n        };\r\n\r\n        await docRef.set(newPlace);\r\n        await enqueueAnalysis(placeId);\r\n\r\n    } catch (error) {\r\n        console.error('Failed to fetch place details:', error);\r\n        throw error;\r\n    }\r\n\r\n    return placeId;\r\n}\r\n\r\nexport interface PlaceSearchResult {\r\n    id: string;\r\n    name: string;\r\n    rating: number;\r\n    userRatingsTotal: number;\r\n    vicinity?: string;\r\n}\r\n\r\nasync function searchPlacesIdOnly(query: string): Promise<string[]> {\r\n    console.log(`Searching places (ID only) for: ${query}`);\r\n    try {\r\n        const auth = new GoogleAuth({\r\n            scopes: 'https://www.googleapis.com/auth/cloud-platform'\r\n        });\r\n        const client = await auth.getClient();\r\n        const token = await client.getAccessToken();\r\n\r\n        const response = await fetch('https://places.googleapis.com/v1/places:searchText', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${token.token}`,\r\n                'X-Goog-FieldMask': 'places.id'\r\n            },\r\n            body: JSON.stringify({\r\n                textQuery: query,\r\n                languageCode: 'ja',\r\n                maxResultCount: 20\r\n            })\r\n        });\r\n\r\n        if (!response.ok) {\r\n            throw new Error(`Google Places API Error: ${response.statusText}`);\r\n        }\r\n\r\n        const data = await response.json();\r\n        return data.places?.map((p: any) => p.id) || [];\r\n    } catch (error) {\r\n        console.error('Failed to search places (ID only):', error);\r\n        return [];\r\n    }\r\n}\r\n\r\nexport interface PlaceSearchResponse {\r\n    places: PlaceSearchResult[];\r\n    nextPageToken?: string;\r\n}\r\n\r\nexport async function searchPlaces(query: string, pageToken?: string): Promise<PlaceSearchResponse> {\r\n    console.log(`Searching places list for: ${query}, pageToken: ${pageToken ? 'Yes' : 'No'}`);\r\n\r\n    try {\r\n        // 1. ID Search (Free) - Skip if paging\r\n        // Pagination usually implies we skip the efficient ID-only check because we can't easily map pages to IDs without fetching.\r\n        // Also, cache logic is complex with pagination.\r\n        // For simplicity: If pageToken is present, go straight to API.\r\n        // If no pageToken, we can TRY cache, but we need to know if we have *all* results?\r\n        // Actually, the previous cache logic was \"If we have ALL 20 IDs in cache\".\r\n        // Now valid for first page.\r\n\r\n        let placeIds: string[] = [];\r\n\r\n        // Only do ID search for first page to check cache\r\n        if (!pageToken) {\r\n            placeIds = await searchPlacesIdOnly(query);\r\n            if (placeIds.length === 0 && !pageToken) return { places: [] };\r\n\r\n            // 2. Check Cache (Only for first page)\r\n            const db = getFirestore();\r\n            const placesRef = db.collection('places');\r\n            const cachedPlaces: PlaceSearchResult[] = [];\r\n            let allCached = true;\r\n\r\n            for (const id of placeIds) {\r\n                const doc = await placesRef.doc(id).get();\r\n                if (doc.exists) {\r\n                    const data = doc.data() as Place;\r\n                    // Check expiration (30 days)\r\n                    const now = new Date();\r\n                    const updatedAt = data.updatedAt ? (data.updatedAt as any).toDate() : new Date(0);\r\n                    const diffTime = Math.abs(now.getTime() - updatedAt.getTime());\r\n                    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));\r\n\r\n                    if (diffDays <= 30 && data.status !== 'error') {\r\n                        cachedPlaces.push({\r\n                            id: data.id,\r\n                            name: data.name,\r\n                            rating: data.originalRating,\r\n                            userRatingsTotal: data.userRatingsTotal,\r\n                            vicinity: data.address\r\n                        });\r\n                    } else {\r\n                        allCached = false;\r\n                        break;\r\n                    }\r\n                } else {\r\n                    allCached = false;\r\n                    break;\r\n                }\r\n            }\r\n\r\n            // 3. Conditional Return (Only if all cached and no page token needed logic?)\r\n            // If we have cached data for the top 20, we return them.\r\n            // Converting cache hits to a \"Next Page\" capable response is tricky because we don't have the nextPageToken from the original API call stored.\r\n            // If we return cached data, the user CANNOT load more because we don't have the token.\r\n            // ERROR: Using cache breaks pagination?\r\n            // \"Load More\" relies on Google's `nextPageToken`. Reviewing flow:\r\n            // Query -> Google API -> Returns items + Token.\r\n            // If we satisfy from Cache, we DON'T have the Token.\r\n            // So if we use Cache, \"Load More\" is impossible unless we re-fetch from API using the original query?\r\n            // Compromise: If we return cached results, we set `nextPageToken` to null.\r\n            // If the user wants \"More\", they might be stuck?\r\n            // Actually, if the cache has 20 items, and we show 20 items...\r\n            // User says \"Load More\". We don't have token.\r\n            // We'd have to trigger a NEW search (API) skipping the first 20? No, Google API doesn't support \"offset\".\r\n            // So, if we want to support \"Load More\", we MUST fetch from API to get the token, OR we accept that \"Cached results have no next page\".\r\n            // Since the user EXPLICITLY requested \"More\", we should prioritize API token availability if possible, OR just disable cache for now to ensure feature works?\r\n            // Or, we return cached results, but if user clicks \"More\" (which won't exist?), they can't.\r\n            // Let's Disable Cache for now to ensure Pagination works correctly as per user request.\r\n            // Or only disable cache if we expect more than 20 results? We don't know.\r\n            // Disabling cache for Search List is safer for this feature.\r\n\r\n            // NOTE: Caching currently disabled for direct search to ensure PAGINATION works (needs fresh nextPageToken).\r\n        }\r\n\r\n        console.log('Fetching fresh data from API...');\r\n\r\n        // 4. Fallback to Full Search (Pro)\r\n        const auth = new GoogleAuth({\r\n            scopes: 'https://www.googleapis.com/auth/cloud-platform'\r\n        });\r\n        const client = await auth.getClient();\r\n        const token = await client.getAccessToken();\r\n\r\n        const requestBody: any = {\r\n            textQuery: query,\r\n            languageCode: 'ja',\r\n            maxResultCount: 20\r\n        };\r\n\r\n        if (pageToken) {\r\n            requestBody.pageToken = pageToken;\r\n        }\r\n\r\n        const response = await fetch('https://places.googleapis.com/v1/places:searchText', {\r\n            method: 'POST',\r\n            headers: {\r\n                'Content-Type': 'application/json',\r\n                'Authorization': `Bearer ${token.token}`,\r\n                'X-Goog-FieldMask': 'places.id,places.displayName,places.formattedAddress,places.rating,places.userRatingCount,places.reviews,places.priceLevel,places.priceRange,places.paymentOptions,places.delivery,places.takeout,places.dineIn,places.reservable,places.servesBeer,places.servesWine,places.servesVegetarianFood,places.servesCoffee,places.servesBreakfast,places.servesLunch,places.servesDinner,places.goodForChildren,places.goodForGroups,places.restroom,places.accessibilityOptions,nextPageToken'\r\n            },\r\n            body: JSON.stringify(requestBody)\r\n        });\r\n\r\n        if (!response.ok) {\r\n            const errorText = await response.text();\r\n            console.error('Google Places API Error:', errorText);\r\n            throw new Error(`Google Places API Error: ${response.statusText}`);\r\n        }\r\n\r\n        const data = await response.json();\r\n\r\n        if (!data.places) {\r\n            return { places: [] };\r\n        }\r\n\r\n        const db = getFirestore(); // Ensure DB is initialized\r\n        const placesRef = db.collection('places');\r\n        const batch = db.batch();\r\n        const results: PlaceSearchResult[] = [];\r\n\r\n        for (const placeData of data.places) {\r\n            const reviews = placeData.reviews?.map((r: any) => r.text?.text).filter(Boolean) || [];\r\n\r\n            // Construct full Place object to cache\r\n            // Use Partial<Place> to avoid 'missing property' errors when we deliberately omit 'status' to preserve it\r\n            const newPlace: Partial<Place> = {\r\n                id: placeData.id,\r\n                name: placeData.displayName?.text || 'Unknown',\r\n                address: placeData.formattedAddress,\r\n                originalRating: placeData.rating || 0,\r\n                userRatingsTotal: placeData.userRatingCount || 0,\r\n                ...(placeData.priceLevel ? { priceLevel: placeData.priceLevel } : {}),\r\n                ...(placeData.priceRange ? { priceRange: placeData.priceRange } : {}),\r\n                reviews: reviews,\r\n                detailedInfo: {\r\n                    paymentOptions: placeData.paymentOptions,\r\n                    serviceOptions: {\r\n                        delivery: placeData.delivery,\r\n                        takeout: placeData.takeout,\r\n                        dineIn: placeData.dineIn,\r\n                        reservable: placeData.reservable\r\n                    },\r\n                    offerings: {\r\n                        servesBeer: placeData.servesBeer,\r\n                        servesWine: placeData.servesWine,\r\n                        servesVegetarianFood: placeData.servesVegetarianFood,\r\n                        servesCoffee: placeData.servesCoffee\r\n                    },\r\n                    diningOptions: {\r\n                        servesBreakfast: placeData.servesBreakfast,\r\n                        servesLunch: placeData.servesLunch,\r\n                        servesDinner: placeData.servesDinner\r\n                    },\r\n                    amenities: {\r\n                        restroom: placeData.restroom,\r\n                        goodForChildren: placeData.goodForChildren,\r\n                        goodForGroups: placeData.goodForGroups\r\n                    }\r\n                },\r\n                updatedAt: new Date(),\r\n            };\r\n\r\n            // Prepare for return\r\n            results.push({\r\n                id: placeData.id,\r\n                name: placeData.displayName?.text || 'Unknown',\r\n                rating: placeData.rating || 0,\r\n                userRatingsTotal: placeData.userRatingCount || 0,\r\n                vicinity: placeData.formattedAddress\r\n            });\r\n\r\n            const ref = placesRef.doc(placeData.id);\r\n            // Use merge: true to update existing docs without wiping other fields\r\n            batch.set(ref, newPlace, { merge: true });\r\n        }\r\n\r\n        await batch.commit();\r\n\r\n        // Fire-and-forget analysis for items needing it\r\n        (async () => {\r\n            const refs = results.map(r => placesRef.doc(r.id));\r\n            if (refs.length === 0) return;\r\n\r\n            try {\r\n                const snapshots = await db.getAll(...refs);\r\n\r\n                for (const snap of snapshots) {\r\n                    const d = snap.data() as Place;\r\n                    // Trigger if:\r\n                    // 1. Status is MISSING (new)\r\n                    // 2. OR Status is 'error'\r\n                    // 3. We do NOT re-trigger if 'pending', 'processing', 'completed'.\r\n                    if (!d.status || d.status === 'error') {\r\n                        console.log(`Triggering analysis for ${d.id}`);\r\n                        // Set status to pending to prevent double-queueing? \r\n                        // Ideally yes, but fire-and-forget.\r\n                        enqueueAnalysis(d.id).catch(e => console.error(`Failed to enqueue ${d.id}`, e));\r\n                    }\r\n                }\r\n            } catch (e) {\r\n                console.error(\"Error checking status for analysis trigger\", e);\r\n            }\r\n        })();\r\n\r\n        return {\r\n            places: results,\r\n            nextPageToken: data.nextPageToken\r\n        };\r\n\r\n    } catch (error) {\r\n        console.error('Failed to search places:', error);\r\n        return { places: [] };\r\n    }\r\n}\r\n"],"names":[],"mappings":";;;;;;;IAuKsB,eAAA,WAAA,GAAA,IAAA,+OAAA,EAAA,8CAAA,oOAAA,EAAA,KAAA,GAAA,0OAAA,EAAA"}},
    {"offset": {"line": 3032, "column": 0}, "map": {"version":3,"sources":["file:///app/src/app/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect, Suspense } from \"react\";\r\nimport { useRouter, useSearchParams } from \"next/navigation\";\r\nimport { doc, onSnapshot } from \"firebase/firestore\";\r\nimport { firestore } from \"@/lib/firebase/client\";\r\nimport SearchInput from \"@/components/ui/SearchInput\";\r\nimport AnalysisResult from \"@/components/AnalysisResult\";\r\nimport ListingCard from \"@/components/ui/ListingCard\";\r\nimport PlaceList from \"@/components/PlaceList\";\r\nimport { Place } from \"@/types/schema\";\r\nimport {\r\n  searchPlaces,\r\n  searchAndAnalyze,\r\n  PlaceSearchResult,\r\n} from \"@/server/actions/place\";\r\nimport { Utensils, Award, Sparkles, TrendingUp, ArrowLeft, Heart } from \"lucide-react\";\r\n\r\n// プレミアム表示用のモックデータ（デモ用）\r\n// 実際のアプリではデータベースから取得しますが、ここでは固定データを使用しています\r\nconst FEATURED_PLACES = [\r\n  {\r\n    id: \"1\",\r\n    title: \"鮨 銀座 おのでら\",\r\n    location: \"東京都中央区銀座\",\r\n    rating: 4.85,\r\n    price: \"¥30,000~\",\r\n    imageUrl:\r\n      \"https://images.unsplash.com/photo-1579871494447-9811cf80d66c?q=80&w=1470&auto=format&fit=crop\",\r\n    tags: [\"寿司\", \"ミシュラン\", \"個室あり\"],\r\n  },\r\n  {\r\n    id: \"2\",\r\n    title: \"L'Effervescence\",\r\n    location: \"東京都港区西麻布\",\r\n    rating: 4.92,\r\n    price: \"¥50,000~\",\r\n    imageUrl:\r\n      \"https://images.unsplash.com/photo-1559339352-11d035aa65de?q=80&w=1374&auto=format&fit=crop\",\r\n    tags: [\"フレンチ\", \"隠れ家\", \"記念日\"],\r\n  },\r\n  {\r\n    id: \"3\",\r\n    title: \"鳥しき\",\r\n    location: \"東京都品川区上大崎\",\r\n    rating: 4.75,\r\n    price: \"¥15,000~\",\r\n    imageUrl:\r\n      \"https://images.unsplash.com/photo-1625937751876-4515cd8e7752?q=80&w=1374&auto=format&fit=crop\",\r\n    tags: [\"焼き鳥\", \"予約困難\", \"カウンター\"],\r\n  },\r\n  {\r\n    id: \"4\",\r\n    title: \"NARISAWA\",\r\n    location: \"東京都港区南青山\",\r\n    rating: 4.88,\r\n    price: \"¥45,000~\",\r\n    imageUrl:\r\n      \"https://images.unsplash.com/photo-1414235077428-338989a2e8c0?q=80&w=1470&auto=format&fit=crop\",\r\n    tags: [\"イノベーティブ\", \"自然派\", \"世界の名店\"],\r\n  },\r\n];\r\n\r\ntype ViewState = \"HOME\" | \"LIST\" | \"DETAIL\";\r\n\r\nfunction HomeContent() {\r\n  const router = useRouter();\r\n  const searchParams = useSearchParams();\r\n\r\n  // URLパラメータから状態を導出\r\n  const viewState = (searchParams.get(\"view\") as ViewState) || \"HOME\";\r\n  const query = searchParams.get(\"q\") || \"\";\r\n  const placeId = searchParams.get(\"id\");\r\n\r\n  const [searchResults, setSearchResults] = useState<PlaceSearchResult[]>([]);\r\n  const [nextPageToken, setNextPageToken] = useState<string | undefined>(undefined);\r\n  const [place, setPlace] = useState<Place | null>(null);\r\n  const [loading, setLoading] = useState(false);\r\n  const [loadingMore, setLoadingMore] = useState(false);\r\n  // Initialize state from URL on first load\r\n  const [focusedAxes, setFocusedAxes] = useState<string[]>(() => {\r\n    const focusParam = searchParams.get(\"focus\");\r\n    return focusParam ? focusParam.split(\",\") : [];\r\n  });\r\n\r\n  const handleAxisToggle = (axisId: string) => {\r\n    let newAxes: string[];\r\n    if (focusedAxes.includes(axisId)) {\r\n      newAxes = focusedAxes.filter(id => id !== axisId);\r\n    } else {\r\n      if (focusedAxes.length >= 2) {\r\n        newAxes = focusedAxes; // Max 2 selected\r\n      } else {\r\n        newAxes = [...focusedAxes, axisId];\r\n      }\r\n    }\r\n\r\n    setFocusedAxes(newAxes);\r\n\r\n    // Sync to URL\r\n    const params = new URLSearchParams(searchParams.toString());\r\n    if (newAxes.length > 0) {\r\n      params.set(\"focus\", newAxes.join(\",\"));\r\n    } else {\r\n      params.delete(\"focus\");\r\n    }\r\n    router.replace(`?${params.toString()}`, { scroll: false });\r\n  };\r\n\r\n  // Also sync state if URL changes externally (e.g. back button)\r\n  useEffect(() => {\r\n    const focusParam = searchParams.get(\"focus\");\r\n    const axes = focusParam ? focusParam.split(\",\") : [];\r\n    // Only update if different to avoid excess renders/loops\r\n    setFocusedAxes(prev => {\r\n      if (prev.length === axes.length && prev.every(v => axes.includes(v))) return prev;\r\n      return axes;\r\n    });\r\n  }, [searchParams]);\r\n\r\n  // URLパラメータの変更を監視してデータを取得\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      if (viewState === \"LIST\" && query) {\r\n        setLoading(true);\r\n        // Reset results when query changes (handled by router but safe to ensure)\r\n        try {\r\n          const response = await searchPlaces(query);\r\n          setSearchResults(response.places);\r\n          setNextPageToken(response.nextPageToken);\r\n        } catch (error) {\r\n          console.error(error);\r\n        } finally {\r\n          setLoading(false);\r\n        }\r\n      } else if (viewState === \"DETAIL\" && placeId) {\r\n        setLoading(true);\r\n        try {\r\n          // 詳細表示の場合は、まず分析/取得アクションを呼ぶ（必要なら）\r\n          // ただし、Firestoreのリスナーでデータ同期するため、ここではIDセットのみで良い場合もあるが、\r\n          // 初回分析トリガーのために searchAndAnalyze を呼ぶ必要がある\r\n          await searchAndAnalyze(placeId);\r\n        } catch (error) {\r\n          console.error(error);\r\n        } finally {\r\n          setLoading(false);\r\n        }\r\n      } else if (viewState === \"HOME\") {\r\n        setSearchResults([]);\r\n        setNextPageToken(undefined);\r\n        setPlace(null);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, [viewState, query, placeId]);\r\n\r\n  // 詳細表示時のリアルタイムリスナー\r\n  useEffect(() => {\r\n    if (viewState !== \"DETAIL\" || !placeId) return;\r\n\r\n    console.log(`Start listening for place: ${placeId}`);\r\n    const unsubscribe = onSnapshot(doc(firestore, \"places\", placeId), (docSnapshot) => {\r\n      if (docSnapshot.exists()) {\r\n        const data = docSnapshot.data() as Place;\r\n        // status check or error handling could be here\r\n        setPlace({ ...data, id: docSnapshot.id });\r\n      } else {\r\n        console.log(\"Place not found in Firestore\");\r\n      }\r\n    }, (error) => {\r\n      console.error(\"Firestore listen error:\", error);\r\n    });\r\n\r\n    return () => unsubscribe();\r\n  }, [viewState, placeId]);\r\n\r\n  const handleLoadMore = async () => {\r\n    if (!nextPageToken || loadingMore) return;\r\n\r\n    setLoadingMore(true);\r\n    try {\r\n      const response = await searchPlaces(query, nextPageToken);\r\n      setSearchResults(prev => [...prev, ...response.places]);\r\n      setNextPageToken(response.nextPageToken);\r\n    } catch (error) {\r\n      console.error(\"Failed to load more\", error);\r\n    } finally {\r\n      setLoadingMore(false);\r\n    }\r\n  };\r\n\r\n  // Firestore Listener for List View (Real-time Analysis Updates)\r\n  useEffect(() => {\r\n    if (searchResults.length === 0) return;\r\n\r\n    // We can't listen to all at once easily if list is huge, but for 20-40 items it's okay to split or just listen.\r\n    // 'in' query limit is 30. We might have more due to \"Load More\".\r\n    // Strategy: Listen to the *latest* batch? Or just the visible ones?\r\n    // If we have 100 items, listening to 100 docs is heavy.\r\n    // But user wants to see scores appear.\r\n    // Let's listen to the *ids* that were just added or all?\r\n    // Let's implement a listener that updates `searchResults` with new data from Firestore.\r\n    // However, `searchResults` is `PlaceSearchResult`. We need to add `trueScore` etc to it.\r\n\r\n    // Better: Render `PlaceList` normally. Pass `searchResults` which are basic.\r\n    // Inside `PlaceList` -> `PlaceCard`, have each card listen to its doc?\r\n    // That is 20-40 listeners. Firestore client handles this well (multiplexes).\r\n    // This isolates the logic and prevents re-rendering the whole List on one item update.\r\n    // PROPOSAL: Don't do it here. Do it in a new component `PlaceListCard` which wraps the display.\r\n    // This allows granular updates.\r\n\r\n    // But `PlaceList` is currently one big component.\r\n    // Let's Refactor `PlaceList` to use a `PlaceCard` component that listens for data.\r\n    // This is clean and scalable.\r\n  }, []); // Intentionally empty or removed, shifting logic to PlaceList logic.\r\n\r\n  // 検索開始時の処理\r\n  const handleSearchStart = () => {\r\n    setLoading(true);\r\n  };\r\n\r\n  const handleSearchComplete = async (newQuery: string) => {\r\n    // URLを更新して遷移\r\n    const params = new URLSearchParams();\r\n    params.set(\"view\", \"LIST\");\r\n    params.set(\"q\", newQuery);\r\n    router.push(`/?${params.toString()}`);\r\n  };\r\n\r\n  const handlePlaceSelect = async (selectedPlaceId: string) => {\r\n    // URLを更新して遷移\r\n    const params = new URLSearchParams();\r\n    params.set(\"view\", \"DETAIL\");\r\n    params.set(\"id\", selectedPlaceId);\r\n    // 検索クエリも保持しておくと戻った時に便利だが、今回はシンプルに\r\n    if (query) params.set(\"q\", query);\r\n    router.push(`/?${params.toString()}`);\r\n  };\r\n\r\n  const resetHome = () => {\r\n    router.push(\"/\");\r\n  };\r\n\r\n  const handleBack = () => {\r\n    router.back();\r\n  };\r\n\r\n  return (\r\n    <main className=\"min-h-screen bg-[#FAFAFA] text-[#1A1A1A] font-serif selection:bg-[#E65100]/20\">\r\n      {/* ナビゲーションバー */}\r\n      <nav className={`absolute top-0 w-full z-50 p-6 flex justify-between items-center transition-colors duration-300 ${viewState === 'HOME' ? 'text-white' : 'text-slate-900'}`}>\r\n        <div\r\n          className=\"text-2xl font-bold tracking-widest cursor-pointer\"\r\n          onClick={resetHome}\r\n        >\r\n          GASTRONOMY AI\r\n        </div>\r\n        <div className=\"hidden md:flex gap-8 text-sm font-medium tracking-wide\">\r\n          <span className=\"cursor-pointer hover:text-[#E65100] transition-colors\">\r\n            COLLECTIONS\r\n          </span>\r\n          <span className=\"cursor-pointer hover:text-[#E65100] transition-colors\">\r\n            ABOUT\r\n          </span>\r\n          <span className=\"cursor-pointer hover:text-[#E65100] transition-colors\">\r\n            LOGIN\r\n          </span>\r\n        </div>\r\n      </nav>\r\n\r\n      {/* ヒーローセクション（ホーム画面でのみ表示） */}\r\n      {viewState === \"HOME\" && (\r\n        <>\r\n          <section className=\"relative h-[80vh] w-full flex flex-col items-center justify-center overflow-hidden\">\r\n            {/* 背景画像 */}\r\n            <div className=\"absolute inset-0 z-0\">\r\n              <img\r\n                src=\"https://images.unsplash.com/photo-1514362545857-3bc16c4c7d1b?q=80&w=2070&auto=format&fit=crop\"\r\n                alt=\"Fine Dining\"\r\n                className=\"w-full h-full object-cover brightness-[0.4]\"\r\n              />\r\n            </div>\r\n\r\n            {/* メインコンテンツ */}\r\n            <div className=\"relative z-10 w-full max-w-4xl px-6 text-center flex flex-col items-center gap-8\">\r\n              <div className=\"space-y-4 animate-in fade-in slide-in-from-bottom-8 duration-1000\">\r\n                <h1 className=\"text-5xl md:text-7xl font-bold text-white tracking-tight text-shadow-lg leading-tight\">\r\n                  真実の<span className=\"text-[#E65100]\">美味</span>を、\r\n                  <br />\r\n                  見極める。\r\n                </h1>\r\n                <p className=\"text-gray-200 text-lg md:text-xl font-sans font-light tracking-wide max-w-2xl mx-auto\">\r\n                  AIが数千の口コミを分析し、隠された名店と真の評価を明らかにします。\r\n                </p>\r\n              </div>\r\n\r\n              <div className=\"w-full max-w-2xl animate-in fade-in slide-in-from-bottom-8 duration-1000 delay-200\">\r\n                <SearchInput\r\n                  onSearchStart={handleSearchStart}\r\n                  onSearchComplete={handleSearchComplete}\r\n                />\r\n              </div>\r\n            </div>\r\n          </section>\r\n\r\n          {/* サービスの価値提案（メリット） */}\r\n          <section className=\"py-24 bg-white\">\r\n            <div className=\"container mx-auto px-6\">\r\n              <div className=\"grid grid-cols-1 md:grid-cols-3 gap-12 text-center\">\r\n                <div className=\"flex flex-col items-center gap-4 group\">\r\n                  <div className=\"w-16 h-16 rounded-full bg-[#FAFAFA] flex items-center justify-center group-hover:bg-[#E65100]/10 transition-colors\">\r\n                    <Sparkles className=\"w-8 h-8 text-[#E65100]\" />\r\n                  </div>\r\n                  <h3 className=\"text-xl font-bold\">AI分析</h3>\r\n                  <p className=\"text-gray-500 font-sans text-sm leading-relaxed\">\r\n                    膨大な口コミから感情を読み解き、\r\n                    <br />\r\n                    数値だけでは見えない魅力を抽出。\r\n                  </p>\r\n                </div>\r\n                <div className=\"flex flex-col items-center gap-4 group\">\r\n                  <div className=\"w-16 h-16 rounded-full bg-[#FAFAFA] flex items-center justify-center group-hover:bg-[#E65100]/10 transition-colors\">\r\n                    <Award className=\"w-8 h-8 text-[#C5A059]\" />\r\n                  </div>\r\n                  <h3 className=\"text-xl font-bold\">真のスコア</h3>\r\n                  <p className=\"text-gray-500 font-sans text-sm leading-relaxed\">\r\n                    サクラや偏見を排除した、\r\n                    <br />\r\n                    純粋な味とサービスの評価を算出。\r\n                  </p>\r\n                </div>\r\n                <div className=\"flex flex-col items-center gap-4 group\">\r\n                  <div className=\"w-16 h-16 rounded-full bg-[#FAFAFA] flex items-center justify-center group-hover:bg-[#E65100]/10 transition-colors\">\r\n                    <TrendingUp className=\"w-8 h-8 text-[#1A1A1A]\" />\r\n                  </div>\r\n                  <h3 className=\"text-xl font-bold\">トレンド予測</h3>\r\n                  <p className=\"text-gray-500 font-sans text-sm leading-relaxed\">\r\n                    次に流行る店、予約困難になる店を\r\n                    <br />\r\n                    いち早くキャッチ。\r\n                  </p>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          </section>\r\n\r\n          {/* 厳選されたコレクション */}\r\n          <section className=\"py-24 bg-[#FAFAFA]\">\r\n            <div className=\"container mx-auto px-6\">\r\n              <div className=\"flex justify-between items-end mb-12\">\r\n                <div>\r\n                  <h2 className=\"text-3xl font-bold mb-2\">Curated Selection</h2>\r\n                  <p className=\"text-gray-500 font-sans\">\r\n                    AIが高く評価した、今行くべき名店\r\n                  </p>\r\n                </div>\r\n                <button className=\"text-[#E65100] font-sans font-medium hover:underline\">\r\n                  View All\r\n                </button>\r\n              </div>\r\n\r\n              {/* 幅が300px以上確保できる限り横に並べ、無理なら折り返す設定 */}\r\n              <div className=\"grid grid-cols-[repeat(auto-fit,minmax(300px,1fr))] gap-4\">\r\n                {FEATURED_PLACES.map((item) => (\r\n                  <ListingCard\r\n                    key={item.id}\r\n                    {...item}\r\n                    onClick={() => console.log(\"Clicked\", item.title)}\r\n                  />\r\n                ))}\r\n              </div>\r\n            </div>\r\n          </section>\r\n        </>\r\n      )}\r\n\r\n      {/* リスト表示（検索結果） */}\r\n      {viewState === \"LIST\" && (\r\n        <div className=\"pt-32 pb-24 min-h-screen bg-slate-50\">\r\n          <div className=\"container mx-auto px-6 mb-8\">\r\n            <div className=\"flex flex-col gap-6\">\r\n              <button\r\n                onClick={handleBack}\r\n                className=\"flex items-center gap-2 text-slate-500 hover:text-[#E65100] transition-colors w-fit font-medium\"\r\n              >\r\n                <ArrowLeft className=\"w-5 h-5\" />\r\n                Back to Home\r\n              </button>\r\n              <div className=\"w-full max-w-4xl mx-auto mb-4\">\r\n                <SearchInput\r\n                  onSearchStart={handleSearchStart}\r\n                  onSearchComplete={handleSearchComplete}\r\n                />\r\n              </div>\r\n\r\n              {/* Axis Selection UI */}\r\n              <div className=\"flex flex-col items-center gap-3 animate-in fade-in slide-in-from-top-4 duration-500\">\r\n                <p className=\"text-sm text-slate-500 font-medium\">重視するポイントを選択すると、あなたへのマッチ度を検索します（最大2つ）</p>\r\n                <div className=\"flex flex-wrap gap-2 justify-center\">\r\n                  {[\r\n                    { id: 'taste', label: '味・料理', icon: Utensils },\r\n                    { id: 'service', label: '接客・サービス', icon: Heart },\r\n                    { id: 'atmosphere', label: '雰囲気・空間', icon: Sparkles },\r\n                    { id: 'cost', label: 'コスパ', icon: TrendingUp },\r\n                  ].map((axis) => {\r\n                    const isSelected = focusedAxes.includes(axis.id);\r\n                    return (\r\n                      <button\r\n                        key={axis.id}\r\n                        onClick={() => handleAxisToggle(axis.id)}\r\n                        className={`\r\n                          flex items-center gap-2 px-4 py-2 rounded-full text-sm font-bold transition-all duration-300 border\r\n                          ${isSelected\r\n                            ? 'bg-[#E65100] text-white border-[#E65100] shadow-md transform scale-105'\r\n                            : 'bg-white text-slate-600 border-slate-200 hover:border-[#E65100] hover:text-[#E65100]'\r\n                          }\r\n                        `}\r\n                      >\r\n                        <axis.icon className=\"w-4 h-4\" />\r\n                        {axis.label}\r\n                      </button>\r\n                    );\r\n                  })}\r\n                </div>\r\n              </div>\r\n\r\n            </div>\r\n          </div>\r\n          <PlaceList\r\n            places={searchResults}\r\n            onSelect={handlePlaceSelect}\r\n            onLoadMore={handleLoadMore}\r\n            hasMore={!!nextPageToken}\r\n            loadingMore={loadingMore}\r\n            focusedAxes={focusedAxes}\r\n          />\r\n        </div>\r\n      )}\r\n\r\n      {/* 詳細表示（分析結果） */}\r\n      {viewState === \"DETAIL\" && place && (\r\n        <div className=\"pt-32 pb-24 container mx-auto px-6 animate-in fade-in duration-500\">\r\n          <button\r\n            onClick={handleBack}\r\n            className=\"flex items-center gap-2 text-slate-500 hover:text-[#E65100] transition-colors mb-6 font-medium\"\r\n          >\r\n            <ArrowLeft className=\"w-5 h-5\" />\r\n            Back to List\r\n          </button>\r\n          <AnalysisResult\r\n            place={place}\r\n            focusedAxes={focusedAxes}\r\n            onToggleAxis={handleAxisToggle}\r\n          />\r\n        </div>\r\n      )}\r\n    </main>\r\n  );\r\n}\r\n\r\nexport default function Home() {\r\n  return (\r\n    <Suspense fallback={\r\n      <div className=\"min-h-screen flex items-center justify-center bg-[#FAFAFA]\">\r\n        <div className=\"animate-pulse text-[#E65100]\">Loading...</div>\r\n      </div>\r\n    }>\r\n      <HomeContent />\r\n    </Suspense>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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"}}]
}